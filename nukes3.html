<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Nuclear Umbrella - SSBN Patrol Routes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        .orbitron { font-family: 'Orbitron', monospace; }
        .speed-card { background: linear-gradient(to bottom right, rgba(31, 41, 55, 0.8), rgba(15, 23, 42, 0.8)); backdrop-filter: blur(10px); border: 1px solid rgba(148, 163, 184, 0.2); }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .shimmer-text { background: linear-gradient(90deg, transparent, #ff6b6b, transparent); background-size: 200% 100%; animation: shimmer 2s linear infinite; }
        #globeViz { width: 100%; height: 800px; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        #globeViz canvas { max-width: 100%; max-height: 100%; }
        .filter-btn { transition: all 0.2s; }
        .filter-btn.active { background: linear-gradient(to right, #dc2626, #f97316); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-red-950 to-slate-900 min-h-screen text-white">
    <div class="container mx-auto p-4">
        <div class="mb-6 speed-card p-6 rounded-xl">
            <h1 class="text-4xl md:text-6xl font-black mb-4 text-center orbitron bg-gradient-to-r from-red-400 via-orange-400 to-yellow-400 bg-clip-text text-transparent shimmer-text">Nuclear SSBN Patrol Network - Scenarios</h1>
            <p class="text-center text-gray-300 text-sm mb-4">Ohio-class submarine patrol circuits and nuclear umbrella coverage zones across current and future scenarios</p>
            <div class="flex flex-wrap justify-center gap-2">
                <button onclick="switchScenario('current')" class="filter-btn active px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="tab-current">Current Patrols</button>
                <button onclick="switchScenario('2034')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="tab-2034">2034 Scenario: 30% US Reduction</button>
                <button onclick="switchScenario('2040')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="tab-2040">2040 Scenario: 60% US Reduction</button>
            </div>
        </div>

        <!-- View Filters -->
        <div class="mb-6 speed-card p-6 rounded-xl">
            <p class="text-center text-gray-300 text-sm mb-4">Sections: All Coverage | Pacific Theater | Atlantic Theater | Umbrella Zones</p>
            <div class="flex flex-wrap justify-center gap-2">
                <button onclick="filterView('all')" class="filter-btn active px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="btn-all">All Coverage</button>
                <button onclick="filterView('pacific')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="btn-pacific">Pacific Theater</button>
                <button onclick="filterView('atlantic')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="btn-atlantic">Atlantic Theater</button>
                <button onclick="filterView('umbrellas')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="btn-umbrellas">Umbrella Zones</button>
            </div>
        </div>

        <div id="loading" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"></div>
            <p class="mt-4 text-gray-400">Loading SSBN patrol data...</p>
        </div>

        <div id="mainContent" class="hidden">
            <!-- Globe -->
            <div class="mb-6 speed-card p-6 rounded-xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold orbitron text-red-400">Strategic Deterrence Network</h2>
                    <div class="text-sm text-gray-400"><span id="patrolInfo">Visualizing SSBN patrol circuits and coverage zones</span></div>
                </div>
                <div id="globeViz"></div>
            </div>

            <!-- Legend & Dashboard -->
            <div class="mb-6 speed-card p-6 rounded-xl">
                <h2 class="text-xl font-bold orbitron mb-4 text-orange-400">Legend</h2>
                <!-- Legend content unchanged for brevity -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- ... same legend as original ... -->
                </div>
            </div>

            <!-- Dashboard Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                <!-- Cards unchanged -->
            </div>

            <!-- Deployments + Implications -->
            <div class="mb-6 speed-card p-6 rounded-xl">
                <h2 class="text-2xl font-bold orbitron mb-4 text-yellow-400">Strategic Deployment Details</h2>
                <div id="deploymentsGrid" class="space-y-4"></div>
                <div id="scenarioInfo"></div>
            </div>
        </div>
    </div>

    <script>
        let nuclearData = []; let rawNuclearData = []; let globe; let currentView = 'all'; let currentScenario = 'current'; let countriesGeoData; 

        // Dynamic umbrella zones – Australia/NZ move to Sino-Russian in 2040
        const umbrellaZones = {
            us: ['United States of America', 'Canada', 'Mexico', 'United Kingdom', 'France', 'Germany', 'Italy', 'Spain', 'Poland', 'Netherlands', 'Belgium', 'Portugal', 'Czech Republic', 'Greece', 'Hungary', 'Sweden', 'Austria', 'Switzerland', 'Denmark', 'Finland', 'Slovakia', 'Norway', 'Ireland', 'Croatia', 'Luxembourg', 'Slovenia', 'Lithuania', 'Latvia', 'Estonia', 'Romania', 'Bulgaria', 'Japan', 'South Korea', 'Philippines', 'Thailand', 'Singapore', 'Taiwan'],
            sinoRussian: ['Russia', 'China', 'North Korea', 'Belarus', 'Kazakhstan', 'Kyrgyzstan', 'Tajikistan', 'Uzbekistan', 'Turkmenistan', 'Mongolia', 'Laos', 'Cambodia', 'Myanmar', 'Iran', 'Venezuela', 'Cuba', 'Nicaragua'],
            saudiPakistan: ['Saudi Arabia', 'United Arab Emirates', 'Jordan', 'Egypt', 'Iraq', 'Kuwait', 'Bahrain', 'Qatar', 'Pakistan'],
            israel: ['Israel'],
            india: ['India', 'Bhutan']
        };

        // Add Australia & New Zealand to Sino-Russian in 2040 scenario
        function getCurrentUmbrellaZones() {
            const zones = JSON.parse(JSON.stringify(umbrellaZones));
            if (currentScenario === '2040') {
                zones.sinoRussian.push('Australia', 'New Zealand');
                zones.us = zones.us.filter(c => c !== 'Australia' && c !== 'New Zealand');
            }
            return zones;
        }

        const patrolCircuitsCurrent = { 
            pacific: [{ coords: [[47.73, -122.71], [50, -140], [52, -160], [50, -175], [45, 170], [40, 160], [35, 150], [30, 140], [35, 130], [40, 135], [45, 140], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Patrol' }], 
            atlantic: [
                { coords: [[30.80, -81.55], [35, -70], [40, -60], [50, -45], [60, -30], [65, -20], [62, -10], [58, 0], [55, 10], [50, 5], [45, -10], [40, -25], [35, -40], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN Patrol' },
                { coords: [[56.03, -4.92], [55, -20], [60, -30], [50, -40], [55, -35], [56.03, -4.92]], color: '#8b5cf6', name: 'UK Vanguard SSBN Patrol' },
                { coords: [[48.39, -4.49], [50, -20], [55, -30], [45, -35], [48.39, -4.49]], color: '#8b5cf6', name: 'French Le Triomphant SSBN Patrol' }
            ],
            // ... rest unchanged for brevity ...
            us_ssn_indian_ocean: [{ coords: [[-7.32, 72.42], [-10, 75], [-12, 80], [-15, 85], [-18, 90], [-20, 95], [-22, 100], [-25, 105], [-28, 110], [-30, 112], [-32, 115.77]], color: '#ef4444', name: 'US SSN Indian Ocean to Australia Patrol' }],
            us_ssn_diego_garcia_patrol: [{ coords: [[-7.32, 72.42], [-5, 70], [-3, 68], [0, 65], [3, 62], [5, 60], [3, 65], [0, 68], [-3, 70], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Diego Garcia Patrol' }],
            us_ssn_malacca_patrol: [{ coords: [[-7.32, 72.42], [0, 80], [2, 90], [3, 98], [2, 102], [1, 101], [2, 100], [3, 98], [0, 90], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Malacca Strait Patrol' }],
            us_ssn_hormuz_patrol: [{ coords: [[-7.32, 72.42], [0, 65], [10, 60], [20, 58], [26, 56], [27, 55], [26, 56.5], [20, 58], [10, 60], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Strait of Hormuz Patrol' }],
            // New continental defense rings for 2040
            us_ssn_americas_north: [{ coords: [[50, -130], [55, -145], [60, -160], [58, -175], [50, -165], [45, -150], [50, -130]], color: '#ef4444', name: 'US SSN North American Defense Ring' }],
            us_ssn_americas_south: [{ coords: [[30, -80], [20, -70], [10, -60], [0, -55], [-10, -60], [-20, -70], [-25, -85], [-20, -100], [0, -110], [20, -100], [30, -80]], color: '#ef4444', name: 'US SSN South/Central American Defense Ring' }],
        };

        function getPatrolCircuits() {
            let pc = JSON.parse(JSON.stringify(patrolCircuitsCurrent));

            if (currentScenario === '2034') {
                // unchanged from original
            } else if (currentScenario === '2040') {
                // 2040: Extreme US retraction
                pc.pacific = [
                    // Tight Hawaiian sanctuary + West Coast only
                    { coords: [[47.73, -122.71], [40, -135], [30, -145], [21, -155], [20, -160], [25, -165], [35, -160], [45, -145], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Patrol (Hawaiian Sanctuary + West Coast Only)' }
                ];

                pc.atlantic[0] = { 
                    coords: [[30.80, -81.55], [35, -75], [38, -65], [35, -60], [30, -65], [28, -75], [30.80, -81.55]], 
                    color: '#8b5cf6', 
                    name: 'U.S. Atlantic SSBN Patrol (Western Atlantic / East Coast Only)' 
                };

                // Remove all Indian Ocean patrols
                delete pc.us_ssn_indian_ocean;
                delete pc.us_ssn_diego_garcia_patrol;
                delete pc.us_ssn_malacca_patrol;
                delete pc.us_ssn_hormuz_patrol;

                // Add continental defense rings
                pc.us_ssn_americas_north = patrolCircuitsCurrent.us_ssn_americas_north;
                pc.us_ssn_americas_south = patrolCircuitsCurrent.us_ssn_americas_south;

                // Expand UK/French SSN patrols
                pc.uk_ssn_giuk = [{ coords: [[56.03, -4.92], [62, -5], [68, 0], [70, 10], [68, 20], [62, 15], [58, 5], [56.03, -4.92]], color: '#f97316', name: 'UK SSN Expanded GIUK/Norwegian Sea Patrol' }];
                pc.french_ssn.push({ coords: [[48.39, -4.49], [55, -5], [60, 0], [58, 10], [50, 5], [48.39, -4.49]], color: '#f97316', name: 'French SSN Expanded North Atlantic Patrol' });
            }
            return pc;
        }

        function getCountryUmbrella(countryName) {
            const zones = getCurrentUmbrellaZones();
            if (zones.us.includes(countryName)) return { color: 'rgba(59, 130, 246, 0.6)', name: 'U.S. Umbrella' };
            if (zones.sinoRussian.includes(countryName)) return { color: 'rgba(22, 163, 74, 0.6)', name: 'Sino-Russian Bloc' };
            if (zones.saudiPakistan.includes(countryName)) return { color: 'rgba(6, 182, 212, 0.6)', name: 'Saudi-Pakistan Umbrella' };
            if (zones.israel.includes(countryName)) return { color: 'rgba(229, 231, 235, 0.6)', name: 'Israeli Arsenal' };
            if (zones.india.includes(countryName)) return { color: 'rgba(180, 83, 9, 0.6)', name: 'Indian Arsenal' };
            return { color: 'rgba(30, 41, 55, 0.4)', name: 'Neutral' };
        }

        // ... rest of initGlobe, updateGlobe, etc. unchanged except using getCurrentUmbrellaZones() ...

        function renderImplications() {
            const info = document.getElementById('scenarioInfo');
            let text = '';
            if (currentScenario === '2040') {
                text = `<h3 class="text-xl font-bold orbitron mb-4 text-orange-400">Strategic Implications: 2040 (60% Reduction)</h3>
                <div class="text-gray-300 space-y-4">
                <p><strong>U.S. nuclear umbrella effectively collapses outside CONUS, UK, and Japan home islands</strong></p>
                <p><strong>Australia and New Zealand fall under Sino-Russian nuclear umbrella</strong></p>
                <p><strong>China achieves total Western Pacific dominance — direct threat to Hawaii</strong></p>
                <p><strong>Russia achieves Atlantic parity — direct threat to U.S. East Coast</strong></p>
                <p><strong>US SSBN/SSN posture reduced to continental defense only</strong></p>
                <ul class="list-disc pl-5">
                    <li>All Indian Ocean presence abandoned</li>
                    <li>Pacific SSBNs confined to Hawaiian sanctuary + West Coast</li>
                    <li>Atlantic SSBNs confined to Western Atlantic approaches</li>
                    <li>New SSN defense rings around North & South America</li>
                </ul>
                <p><strong>UK & France expand SSN patrols to preserve European deterrence</strong></p>
                <p><strong>Proliferation cascade inevitable:</strong></p>
                <ul class="list-disc pl-5">
                    <li>Australia likely pursues independent nuclear deterrent</li>
                    <li>South Korea, Taiwan, Poland accelerate nuclear programs</li>
                    <li>Philippines, Thailand may realign toward China</li>
                </ul>
                <h4 class="text-lg font-bold text-yellow-400 mt-4 mb-2">Industrial Collapse Impact:</h4>
                <ul class="list-disc pl-5">
                    <li>US submarine construction drops 40–60%</li>
                    <li>Columbia-class delayed indefinitely</li>
                    <li>Early Ohio-class retirements</li>
                </ul>
                </div>`;
            }
            // other scenarios unchanged
            info.innerHTML = text || info.innerHTML;
        }

        // Load TopoJSON then data
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/topojson-client@3/dist/topojson-client.min.js';
        script.onload = () => { loadData(); };
        document.head.appendChild(script);
    </script>
</body>
</html>
