<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuclear Umbrella Collapse · 2034–2040</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <!-- THIS LINE WAS MISSING → fixes the error -->
    <script src="https://unpkg.com/topojson-client@3"></script>
    <style>
        body { background: radial-gradient(circle at top left, #1e1b4b, #0f0f1e); min-height: 100vh; }
        .orbitron { font-family: 'Orbitron', sans-serif; }
        .card { background: rgba(30,41,55,0.85); backdrop-filter: blur(12px); border: 1px solid rgba(100,116,139,0.3); }
        @keyframes glow { 0%,100% { text-shadow: 0 0 20px #ff006e; } 50% { text-shadow: 0 0 40px #ff006e, 0 0 60px #ff006e; } }
        h1 { animation: glow 4s infinite; }
        .tab.active { background: linear-gradient(135deg, #dc2626, #f97316); box-shadow: 0 0 30px rgba(239,68,68,0.6); }
        .view-btn.active { background: #1e40af; box-shadow: 0 0 20px rgba(59,130,246,0.7); }
    </style>
</head>
<body class="text-white">
<div class="container mx-auto p-6 max-w-7xl">

    <div class="text-center mb-10 card p-10 rounded-3xl">
        <h1 class="text-5xl md:text-7xl font-black orbitron bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 bg-clip-text text-transparent">
            NUCLEAR UMBRELLA COLLAPSE
        </h1>
        <p class="text-xl mt-4 text-gray-300">2034 → 2040 Strategic Retreat</p>
        <div class="flex justify-center gap-6 mt-8 flex-wrap">
            <button onclick="setYear('current')" class="tab active px-8 py-4 rounded-xl text-lg font-bold transition" id="tab-current">2025: Status Quo</button>
            <button onclick="setYear('2034')" class="tab px-8 py-4 rounded-xl text-lg font-bold transition" id="tab-2034">2034: 30% US Cut</button>
            <button onclick="setYear('2040')" class="tab px-8 py-4 rounded-xl text-lg font-bold transition" id="tab-2040">2040: Collapse</button>
        </div>
    </div>

    <div class="grid grid-cols-4 gap-4 mb-8">
        <button onclick="setView('all')"     class="view-btn active py-4 rounded-xl font-bold" id="v-all">All</button>
        <button onclick="setView('pacific')" class="view-btn py-4 rounded-xl font-bold" id="v-pacific">Pacific</button>
        <button onclick="setView('atlantic')"class="view-btn py-4 rounded-xl font-bold" id="v-atlantic">Atlantic</button>
        <button onclick="setView('umbrellas')"class="view-btn py-4 rounded-xl font-bold" id="v-umbrellas">Umbrellas</button>
    </div>

    <div id="globeViz" class="card rounded-3xl overflow-hidden shadow-2xl" style="height: 800px;"></div>

    <div class="grid grid-cols-2 md:grid-cols-5 gap-6 mt-10">
        <div class="card p-6 text-center rounded-2xl"><div class="text-5xl">US</div><div class="text-4xl font-black text-blue-400 mt-2" id="us-warheads">5,244</div><div class="text-sm text-gray-400">Total Warheads</div></div>
        <div class="card p-6 text-center rounded-2xl"><div class="text-5xl">RU+CN</div><div class="text-4xl font-black text-green-400 mt-2" id="rc-warheads">7,420</div><div class="text-sm text-gray-400">Sino-Russian Bloc</div></div>
        <div class="card p-6 text-center rounded-2xl"><div class="text-5xl">PK/SA</div><div class="text-3xl font-black text-cyan-400 mt-2">~520</div></div>
        <div class="card p-6 text-center rounded-2xl"><div class="text-5xl">IL</div><div class="text-3xl font-black text-gray-300 mt-2">~90</div></div>
        <div class="card p-6 text-center rounded-2xl"><div class="text-5xl">IN</div><div class="text-3xl font-black text-amber-400 mt-2">~300</div></div>
    </div>

    <div class="card p-10 mt-10 rounded-3xl">
        <h2 class="text-4xl font-black orbitron text-yellow-400 mb-8">Strategic Implications</h2>
        <div id="implications" class="text-lg leading-relaxed text-gray-200"></div>
    </div>
</div>

<script>
let globe, currentYear = 'current', currentView = 'all';

// ==================== PATROL PATHS ====================
const patrols = {
    current: [
        {c:[[47.7,-122.7],[52,-160],[48,-175],[40,170],[35,140],[47.7,-122.7]], col:'#3b82f6', name:'U.S. Pacific SSBN Patrol'},
        {c:[[30.8,-81.6],[40,-70],[55,-40],[62,-15],[50,5],[30.8,-81.6]], col:'#8b5cf6', name:'U.S. Atlantic SSBN Patrol'},
        {c:[[18.2,109.5],[15,118],[10,125],[18.2,109.5]], col:'#94a3b8', name:'China SSBN Bastion'},
        {c:[[53,158],[58,175],[55,-170],[50,160],[53,158]], col:'#94a3b8', name:'Russia Pacific Bastion'}
    ],
    '2034': [
        {c:[[47.7,-122.7],[48,-150],[45,-165],[40,-175],[47.7,-122.7]], col:'#3b82f6', name:'U.S. Pacific SSBN (Reduced – Mid-Pacific only)'},
        {c:[[30.8,-81.6],[38,-70],[48,-50],[52,-30],[45,-20],[30.8,-81.6]], col:'#8b5cf6', name:'U.S. Atlantic SSBN (Reduced – No GIUK)'},
        {c:[[21,-158],[15,-170],[10,170],[15,155],[21,-158]], col:'#ef4444', name:'U.S. SSN Hawaii Defense Ring'},
        {c:[[18.2,109.5],[20,130],[28,145],[25,160],[18.2,109.5]], col:'#22c55e', name:'China SSBN → Second Island Chain'},
        {c:[[18.2,109.5],[5,110],[-10,105],[-20,115],[-10,130],[5,125],[18.2,109.5]], col:'#22c55e', name:'China SSN → Northern Australia'},
        {c:[[69,33],[70,10],[68,-10],[65,-25],[69,33]], col:'#94a3b8', name:'Russia SSBN → GIUK Penetration'}
    ],
    '2040': [
        {c:[[47.7,-122.7],[35,-140],[25,-150],[21,-158],[30,-165],[47.7,-122.7]], col:'#3b82f6', name:'U.S. Pacific SSBN – Hawaiian Sanctuary'},
        {c:[[30.8,-81.6],[35,-75],[40,-68],[38,-65],[30.8,-81.6]], col:'#8b5cf6', name:'U.S. Atlantic SSBN – East Coast Bastion'},
        {c:[[40,-75],[48,-60],[45,-50],[38,-65],[40,-75]], col:'#ef4444', name:'U.S. SSN East Coast Ring'},
        {c:[[25,-90],[15,-100],[5,-105],[-5,-95],[25,-90]], col:'#ef4444', name:'U.S. SSN Caribbean Ring'},
        {c:[[18.2,109.5],[22,150],[20,170],[15,175],[18.2,109.5]], col:'#22c55e', name:'China SSBN → Hawaii Approaches'},
        {c:[[18.2,109.5],[40,165],[50,-170],[45,175],[18.2,109.5]], col:'#22c55e', name:'China SSBN → Alaska Interdiction'},
        {c:[[18.2,109.5],[0,115],[-25,110],[-40,130],[-35,160],[-10,165],[10,150],[18.2,109.5]], col:'#22c55e', name:'China SSN Encirclement of Australia'},
        {c:[[56,-5],[68,5],[70,20],[65,30],[56,-5]], col:'#8b5cf6', name:'UK/French GIUK-Norwegian Defense'}
    ]
};

function getPatrols() {
    return patrols[currentYear].map(p => ({
        coords: p.c.map(pt=>[pt[0],pt[1]]),
        color: p.col,
        label: p.name
    }));
}

// ==================== UMBRELLA ZONES ====================
function getUmbrella(country) {
    const usCore = ['United States of America','Canada','Mexico','United Kingdom','France','Germany','Italy','Poland','Japan','South Korea'];
    const sinoRusCore = ['Russia','China','North Korea','Iran','Venezuela','Cuba'];

    if (currentYear === '2040') {
        const sinoRus2040 = [...sinoRusCore, 'Australia','New Zealand','Philippines','Thailand','Singapore','Taiwan','Indonesia','Malaysia','Vietnam','Cambodia','Laos','Myanmar'];
        if (sinoRus2040.includes(country)) return {col:'rgba(34,197,94,0.92)', name:'Sino-Russian Bloc'};
    }
    if (currentYear === '2034') {
        if (['Taiwan','Philippines'].includes(country)) return {col:'rgba(34,197,94,0.6)', name:'Sino-Russian Influence'};
    }
    if (usCore.includes(country)) return {col:'rgba(59,130,246,0.7)', name:'U.S. Umbrella'};
    if (sinoRusCore.includes(country)) return {col:'rgba(34,197,94,0.7)', name:'Sino-Russian Core'};
    return {col:'rgba(60,60,80,0.4)', name:'Neutral'};
}

// ==================== WARHEAD COUNTERS ====================
function updateNumbers() {
    let us = 5244, rc = 7420;
    if (currentYear === '2034') { us = 3660; rc = 11130; }
    if (currentYear === '2040') { us = 2100; rc = 18500; }
    document.getElementById('us-warheads').textContent = us.toLocaleString();
    document.getElementById('rc-warheads').textContent = rc.toLocaleString();
}

// ==================== IMPLICATIONS ====================
function renderImplications() {
    const el = document.getElementById('implications');
    if (currentYear === 'current') {
        el.innerHTML = `<p class="text-xl">2025: The U.S. maintains a robust global nuclear umbrella. Continuous at-sea deterrence covers allies in Europe and Asia.</p>`;
    } else if (currentYear === '2034') {
        el.innerHTML = `
            <h3 class="text-3xl font-bold text-orange-500 mb-6">2034: Credibility Erosion Begins</h3>
            <ul class="space-y-4 text-lg">
                <li>U.S. cuts warheads and patrol zones by ~30%</li>
                <li>Pacific SSBNs abandon First Island Chain</li>
                <li>Atlantic SSBNs withdraw from GIUK Gap</li>
                <li>China breaches Second Island Chain</li>
                <li>Russia regularly penetrates GIUK</li>
                <li>Taiwan & Philippines lose credible protection</li>
                <li>Japan and South Korea go nuclear-latent</li>
                <li class="font-bold text-yellow-400">The umbrella is leaking.</li>
            </ul>`;
    } else {
        el.innerHTML = `
            <h3 class="text-4xl font-bold text-red-600 mb-6">2040: THE UMBRELLA IS GONE</h3>
            <ul class="space-y-5 text-xl">
                <li>U.S. SSBNs confined to Hawaii and East Coast</li>
                <li>All Indian Ocean presence eliminated</li>
                <li>Australia, New Zealand, and Southeast Asia under Chinese sphere</li>
                <li>China patrols off Hawaii and Alaska</li>
                <li>Chinese SSNs encircle Australia</li>
                <li>Only UK & France defend North Atlantic</li>
                <li class="text-3xl font-black text-yellow-500 mt-10">Post-1945 order ended.</li>
            </ul>`;
    }
}

// ==================== GLOBE ====================
async function initGlobe() {
    const resp = await fetch('https://unpkg.com/world-atlas/countries-110m.json');
    const topo = await resp.json();
    const countries = topojson.feature(topo, topo.objects.countries).features;

    globe = Globe()(document.getElementById('globeViz'))
        .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
        .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
        .pointOfView({lat:25, lng:130, altitude:2.8})
        .polygonsData(countries)
        .polygonCapColor(f => getUmbrella(f.properties.name).col)
        .polygonSideColor(() => 'rgba(0,0,0,0.2)')
        .polygonStrokeColor(() => '#333')
        .polygonLabel(f => `<b>${f.properties.name}</b><br>${getUmbrella(f.properties.name).name}`)
        .pathsData(getPatrols())
        .pathPointLat(p=>p[0])
        .pathPointLng(p=>p[1])
        .pathColor('color')
        .pathLabel('label')
        .pathStroke(3.5)
        .pathDashLength(0.25)
        .pathDashGap(0.12)
        .pathDashAnimateTime(12000);
}

function setView(v) {
    currentView = v;
    [...document.querySelectorAll('.view-btn')].forEach(b=>b.classList.remove('active'));
    document.getElementById('v-'+v).classList.add('active');
    globe.pathsData(v==='umbrellas' ? [] : getPatrols());
}

function setYear(y) {
    currentYear = y;
    [...document.querySelectorAll('.tab')].forEach(b=>b.classList.remove('active'));
    document.getElementById('tab-'+y).classList.add('active');
    globe.pathsData(getPatrols()).polygonsData(globe.polygonsData());
    updateNumbers();
    renderImplications();
}

// Start
initGlobe().then(() => {
    updateNumbers();
    renderImplications();
});
</script>
</body>
</html>
