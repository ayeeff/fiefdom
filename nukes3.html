<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuclear Umbrella Collapse - 2040</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <style>
        .orbitron { font-family: 'Orbitron', monospace; }
        .speed-card { background: linear-gradient(to bottom right, rgba(31,41,55,0.9), rgba(15,23,42,0.9)); backdrop-filter: blur(12px); border: 1px solid rgba(148,163,184,0.2); }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .shimmer-text { background: linear-gradient(90deg, transparent, #ff6b6b, transparent); background-size: 200% 100%; animation: shimmer 2s linear infinite; }
        #globeViz { width: 100%; height: 800px; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        .filter-btn.active { background: linear-gradient(to right, #dc2626, #f97316); box-shadow: 0 4px 20px rgba(239,68,68,0.5); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-red-950 to-black min-h-screen text-white">
<div class="container mx-auto p-6">

    <div class="mb-8 speed-card p-8 rounded-2xl text-center">
        <h1 class="text-5xl md:text-7xl font-black orbitron bg-gradient-to-r from-red-400 via-orange-400 to-yellow-400 bg-clip-text text-transparent shimmer-text">
            NUCLEAR UMBRELLA COLLAPSE · 2040
        </h1>
        <p class="mt-4 text-gray-300 text-lg">U.S. strategic retreat · Sino-Russian dominance</p>
        <div class="flex flex-wrap justify-center gap-4 mt-6">
            <button onclick="switchScenario('current')" class="filter-btn active px-6 py-3 rounded-lg font-bold" id="tab-current">2025 Current</button>
            <button onclick="switchScenario('2034')" class="filter-btn px-6 py-3 rounded-lg font-bold" id="tab-2034">2034: 30% US Cut</button>
            <button onclick="switchScenario('2040')" class="filter-btn px-6 py-3 rounded-lg font-bold" id="tab-2040">2040: Collapse</button>
        </div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <button onclick="filterView('all')" class="filter-btn active py-3 rounded-lg font-semibold" id="btn-all">All Coverage</button>
        <button onclick="filterView('pacific')" class="filter-btn py-3 rounded-lg font-semibold" id="btn-pacific">Pacific</button>
        <button onclick="filterView('atlantic')" class="filter-btn py-3 rounded-lg font-semibold" id="btn-atlantic">Atlantic</button>
        <button onclick="filterView('umbrellas')" class="filter-btn py-3 rounded-lg font-semibold" id="btn-umbrellas">Umbrellas</button>
    </div>

    <div id="loading" class="text-center py-20 hidden">
        <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-red-500"></div>
    </div>

    <div id="mainContent">
        <div class="speed-card p-6 rounded-2xl mb-8">
            <h2 class="text-3xl font-bold orbitron text-red-400 mb-4">Global SSBN/SSN Patrol Network</h2>
            <div id="globeViz"></div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-5 gap-6 mb-8">
            <div class="speed-card p-6 rounded-xl text-center">
                <div class="text-4xl mb-2">US</div>
                <div class="text-3xl font-black text-blue-400" id="us-total">5,244</div>
                <div class="text-sm text-gray-400">Total Warheads</div>
            </div>
            <div class="speed-card p-6 rounded-xl text-center">
                <div class="text-4xl mb-2">RU+CN</div>
                <div class="text-3xl font-black text-green-400" id="rc-total">7,420</div>
                <div class="text-sm text-gray-400">Sino-Russian Bloc</div>
            </div>
            <div class="speed-card p-6 rounded-xl text-center">
                <div class="text-4xl mb-2">PK/SA</div>
                <div class="text-3xl font-black text-cyan-400">~520</div>
                <div class="text-sm text-gray-400">Islamic Bomb</div>
            </div>
            <div class="speed-card p-6 rounded-xl text-center">
                <div class="text-4xl mb-2">IL</div>
                <div class="text-3xl font-black text-gray-300">~90</div>
                <div class="text-sm text-gray-400">Samson Option</div>
            </div>
            <div class="speed-card p-6 rounded-xl text-center">
                <div class="text-4xl mb-2">IN</div>
                <div class="text-3xl font-black text-amber-400">~300</div>
                <div class="text-sm text-gray-400">Independent</div>
            </div>
        </div>

        <div class="speed-card p-8 rounded-2xl">
            <h2 class="text-3xl font-bold orbitron text-yellow-400 mb-6">Strategic Implications</h2>
            <div id="scenarioInfo" class="text-gray-300 text-lg leading-relaxed"></div>
        </div>
    </div>
</div>

<script>
// ====================== HARD-CODED NUCLEAR DATA ======================
const nuclearDataRaw = [
    { country: "USA Pacific SSBN", total: 3360, slbm: 2880, base: "Bangor, WA / Pearl Harbor", region: "Pacific" },
    { country: "USA Atlantic SSBN", total: 1884, slbm: 1600, base: "Kings Bay, GA", region: "Atlantic" },
    { country: "Russia Pacific Fleet", total: 960, slbm: 672, base: "Kamchatka", region: "Pacific" },
    { country: "Russia Northern Fleet", total: 1440, slbm: 1152, base: "Gadzhiyevo", region: "Atlantic" },
    { country: "China PLAN SSBN", total: 480, slbm: 384, base: "Hainan", region: "Pacific" },
    { country: "UK Vanguard", total: 225, slbm: 160, base: "Faslane", region: "Atlantic" },
    { country: "France Triomphant", total: 300, slbm: 240, base: "Île Longue", region: "Atlantic" },
    { country: "India SSBN", total: 96, slbm: 64, base: "Visakhapatnam", region: "Indian" },
    { country: "Pakistan", total: 320, slbm: 0, base: "Karachi", region: "Indian" },
    { country: "Israel", total: 90, slbm: 0, base: "Haifa", region: "Med" },
    { country: "North Korea", total: 80, slbm: 0, base: "Sinpo", region: "Pacific" }
];

let nuclearData = [];
let globe, currentView = 'all', currentScenario = 'current';

// Dynamic umbrellas
function getUmbrellas() {
    if (currentScenario === '2040') {
        return {
            us: ['United States of America','Canada','Mexico','United Kingdom','France','Germany','Italy','Poland','Netherlands','Japan','South Korea'],
            sinoRussian: ['Russia','China','North Korea','Australia','New Zealand','Philippines','Thailand','Singapore','Taiwan','Indonesia','Malaysia','Vietnam','Cambodia','Laos','Myanmar','Iran','Venezuela','Cuba']
        };
    }
    return {
        us: ['United States of America','Canada','Mexico','United Kingdom','France','Germany','Italy','Spain','Poland','Japan','South Korea','Australia','New Zealand','Philippines','Thailand','Singapore','Taiwan'],
        sinoRussian: ['Russia','China','North Korea','Iran','Venezuela','Cuba']
    };
}

function getCountryUmbrella(name) {
    const u = getUmbrellas();
    if (u.us.includes(name)) return { color: 'rgba(59,130,246,0.7)', name: 'U.S. Umbrella' };
    if (u.sinoRussian.includes(name)) return { color: 'rgba(34,197,94,0.85)', name: 'Sino-Russian Bloc' };
    return { color: 'rgba(30,41,55,0.4)', name: 'Neutral' };
}

// Hardcoded patrol paths
const patrols = {
    current: [
        { coords: [[47.7,-122.7],[50,-140],[52,-160],[45,170],[35,150],[47.7,-122.7]], color: '#3b82f6', name: 'U.S. Pacific SSBN' },
        { coords: [[30.8,-81.6],[40,-70],[50,-45],[60,-20],[50,0],[30.8,-81.6]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN' },
        { coords: [[18.2,109.5],[15,120],[10,130],[20,125],[18.2,109.5]], color: '#d0f4de', name: 'China SSBN Bastion' },
        { coords: [[53,158],[60,175],[58,-170],[50,160],[53,158]], color: '#d0f4de', name: 'Russia Pacific Bastion' }
    ],
    '2040': [
        // U.S. Fortress America
        { coords: [[47.7,-122.7],[40,-140],[30,-135],[21,-158],[30,-165],[47.7,-122.7]], color: '#3b82f6', name: 'U.S. Pacific Sanctuary (Hawaii Only)' },
        { coords: [[30.8,-81.6],[35,-75],[40,-70],[38,-65],[30.8,-81.6]], color: '#8b5cf6', name: 'U.S. Atlantic Bastion (East Coast)' },
        { coords: [[40,-75],[45,-65],[48,-55],[40,-75]], color: '#ef4444', name: 'U.S. SSN East Coast Ring' },
        { coords: [[30,-90],[20,-100],[10,-105],[-10,-90],[30,-90]], color: '#ef4444', name: 'U.S. SSN Caribbean Ring' },
        // China dominates
        { coords: [[18.2,109.5],[20,150],[22,170],[18,175],[18.2,109.5]], color: '#d0f4de', name: 'China SSBN → Hawaii' },
        { coords: [[18.2,109.5],[35,160],[45,175],[50,-170],[18.2,109.5]], color: '#d0f4de', name: 'China SSBN → Alaska' },
        { coords: [[18.2,109.5],[0,110],[-30,120],[-35,150],[-20,160],[0,150],[18.2,109.5]], color: '#22c55e', name: 'China SSN Encirclement of Australia' },
        // UK/France hold the line
        { coords: [[56,-5],[65,0],[70,10],[65,20],[56,-5]], color: '#8b5cf6', name: 'UK/FR GIUK Defense' }
    ]
};

function getPatrols() {
    return currentScenario === '2040' ? patrols['2040'] : patrols.current;
}

function updateNumbers() {
    let usTotal = 5244, rcTotal = 0;
    if (currentScenario === '2034') {
        usTotal = Math.round(5244 * 0.7);
        rcTotal = Math.round((960+1440+480+80) * 1.5);
    } else if (currentScenario === '2040') {
        usTotal = Math.round(5244 * 0.4);
        rcTotal = Math.round((960+1440+480+80) * 2.8);
    } else {
        rcTotal = 960+1440+480+80;
    }
    document.getElementById('us-total').textContent = usTotal.toLocaleString();
    document.getElementById('rc-total').textContent = rcTotal.toLocaleString();
}

function renderImplications() {
    const el = document.getElementById('scenarioInfo');
    if (currentScenario === '2040') {
        el.innerHTML = `
            <h3 class="text-3xl font-bold text-red-500 mb-6">THE U.S. NUCLEAR UMBRELLA HAS COLLAPSED</h3>
            <ul class="space-y-4 text-lg">
                <li>Australia, New Zealand, Philippines, Thailand, Singapore, Taiwan — now under effective Chinese protection</li>
                <li>U.S. SSBNs confined to Hawaiian and East Coast bastions</li>
                <li>All U.S. presence withdrawn from Indian Ocean</li>
                <li>China patrols off Hawaii and Alaska</li>
                <li>Chinese SSNs fully encircle Australia</li>
                <li>UK and France alone defend the North Atlantic</li>
                <li class="text-2xl font-black text-yellow-500 mt-8">The post-1945 order is over.</li>
            </ul>`;
    } else if (currentScenario === '2034') {
        el.innerHTML = `<p class="text-xl text-orange-400">30% U.S. reduction begins erosion of extended deterrence. Allies begin hedging.</p>`;
    } else {
        el.innerHTML = `<p class="text-xl text-gray-400">2025: U.S. maintains global umbrella. Credible second-strike posture intact.</p>`;
    }
}

async function init() {
    // Load world map
    const resp = await fetch('https://unpkg.com/world-atlas/countries-110m.json');
    const topo = await resp.json();
    const countries = topojson.feature(topo, topo.objects.countries).features;

    globe = Globe()(document.getElementById('globeViz'))
        .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
        .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
        .pointOfView({ lat: 25, lng: 130, altitude: 2.5 })
        .polygonsData(countries)
        .polygonCapColor(f => getCountryUmbrella(f.properties.name).color)
        .polygonSideColor(() => 'rgba(0,0,0,0.15)')
        .polygonStrokeColor(() => '#333')
        .polygonLabel(f => `<b>${f.properties.name}</b><br>${getCountryUmbrella(f.properties.name).name}`)
        .pathsData(getPatrols())
        .pathPoints('coords')
        .pathPointLat(p => p[0])
        .pathPointLng(p => p[1])
        .pathColor('color')
        .pathLabel('name')
        .pathStroke(3)
        .pathDashLength(0.2)
        .pathDashGap(0.1)
        .pathDashAnimateTime(10000);

    document.getElementById('loading').classList.add('hidden');
    document.getElementById('mainContent').classList.remove('hidden');
    updateNumbers();
    renderImplications();
}

function filterView(v) {
    currentView = v;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(`btn-${v}`).classList.add('active');
    globe.pathsData(v === 'umbrellas' ? [] : getPatrols());
}

function switchScenario(s) {
    currentScenario = s;
    document.querySelectorAll('[id^="tab-"]').forEach(b => b.classList.remove('active'));
    document.getElementById(`tab-${s}`).classList.add('active');
    globe.pathsData(getPatrols()).polygonsData(globe.polygonsData()); // refresh colors
    updateNumbers();
    renderImplications();
}

// Start
init();
</script>
</body>
</html>
