<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Nuclear Umbrella - SSBN Patrol Routes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>.orbitron { font-family: 'Orbitron', monospace; } .speed-card { background: linear-gradient(to bottom right, rgba(31, 41, 55, 0.8), rgba(15, 23, 42, 0.8)); backdrop-filter: blur(10px); border: 1px solid rgba(148, 163, 184, 0.2); } @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } } .shimmer-text { background: linear-gradient(90deg, transparent, #ff6b6b, transparent); background-size: 200% 100%; animation: shimmer 2s linear infinite; } #globeViz { width: 100%; height: 800px; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; } #globeViz canvas { max-width: 100%; max-height: 100%; } .filter-btn { transition: all 0.2s; } .filter-btn.active { background: linear-gradient(to right, #dc2626, #f97316); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4); }</style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-red-950 to-slate-900 min-h-screen text-white">
    <!-- [All HTML head/body structure remains identical until script] -->

    <script>
        let nuclearData = []; let rawNuclearData = []; let globe; let currentView = 'all'; let currentScenario = 'current'; let countriesGeoData; 
        const umbrellaZonesBase = { 
            us: ['United States of America', 'Canada', 'Mexico', 'United Kingdom', 'France', 'Germany', 'Italy', 'Spain', 'Poland', 'Netherlands', 'Belgium', 'Portugal', 'Czech Republic', 'Greece', 'Hungary', 'Sweden', 'Austria', 'Switzerland', 'Denmark', 'Finland', 'Slovakia', 'Norway', 'Ireland', 'Croatia', 'Luxembourg', 'Slovenia', 'Lithuania', 'Latvia', 'Estonia', 'Romania', 'Bulgaria', 'Japan', 'South Korea', 'Philippines', 'Thailand', 'Singapore', 'Taiwan'],
            sinoRussian: ['Russia', 'China', 'North Korea', 'Belarus', 'Kazakhstan', 'Kyrgyzstan', 'Tajikistan', 'Uzbekistan', 'Turkmenistan', 'Mongolia', 'Laos', 'Cambodia', 'Myanmar', 'Iran', 'Venezuela', 'Cuba', 'Nicaragua'],
            saudiPakistan: ['Saudi Arabia', 'United Arab Emirates', 'Jordan', 'Egypt', 'Iraq', 'Kuwait', 'Bahrain', 'Qatar', 'Pakistan'],
            israel: ['Israel'],
            india: ['India', 'Bhutan']
        };

        // Dynamic umbrella zones â€” Australia flips in 2040
        function getUmbrellaZones() {
            if (currentScenario === '2040') {
                return {
                    ...umbrellaZonesBase,
                    us: umbrellaZonesBase.us.filter(c => !['Australia', 'New Zealand'].includes(c)),
                    sinoRussian: [...umbrellaZonesBase.sinoRussian, 'Australia', 'New Zealand']
                };
            }
            return umbrellaZonesBase;
        }
        let umbrellaZones = getUmbrellaZones();

        const patrolCircuitsCurrent = { 
            pacific: [{ coords: [[47.73, -122.71], [50, -140], [52, -160], [50, -175], [45, 170], [40, 160], [35, 150], [30, 140], [35, 130], [40, 135], [45, 140], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Patrol' }], 
            atlantic: [{ coords: [[30.80, -81.55], [35, -70], [40, -60], [50, -45], [60, -30], [65, -20], [62, -10], [58, 0], [55, 10], [50, 5], [45, -10], [40, -25], [35, -40], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN Patrol' },
            /* ... all other current patrols unchanged ... */
        }; 

        function getPatrolCircuits() {
            let pc = JSON.parse(JSON.stringify(patrolCircuitsCurrent));

            if (currentScenario === '2040') {
                // U.S. SSBNs retreat to Hawaiian sanctuary + continental waters only
                pc.pacific = [
                    { coords: [[47.73, -122.71], [45, -135], [40, -145], [35, -155], [30, -165], [25, -170], [21, -160], [25, -150], [30, -140], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Hawaiian Sanctuary' }
                ];
                pc.atlantic[0] = { coords: [[30.80, -81.55], [32, -75], [35, -65], [38, -60], [35, -55], [32, -65], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN East Coast Sanctuary' };

                // NEW: U.S. SSN continental defense rings
                pc.us_ssn_americas = [
                    { coords: [[47.73, -122.71], [50, -130], [45, -110], [30, -90], [20, -80], [10, -70], [0, -60], [-20, -50], [-40, -70], [-50, -100], [-40, -130], [0, -170], [30, -160], [47.73, -122.71]], color: '#ef4444', name: 'U.S. SSN Americas Defense Ring' }
                ];

                // REMOVE all Indian Ocean activity
                delete pc.us_ssn_indian_ocean;
                delete pc.us_ssn_diego_garcia_patrol;
                delete pc.us_ssn_malacca_patrol;
                delete pc.us_ssn_hormuz_patrol;

                // Keep/enhance UK & French patrols around Europe
                pc.uk_ssn_giuk = [
                    { coords: [[56.03, -4.92], [62, -10], [65, -15], [68, -20], [66, -25], [62, -20], [58, -12], [56.03, -4.92]], color: '#f97316', name: 'UK SSN Reinforced GIUK Gap' }
                ];
                pc.french_ssn.push(
                    { coords: [[48.39, -4.49], [50, -10], [55, -15], [58, -10], [55, -5], [50, -10], [48.39, -4.49]], color: '#f97316', name: 'French SSN North Atlantic/GIUK Support' }
                );

                // Chinese dominance (unchanged from previous 2040)
                pc.chinese.push(
                    { coords: [[18.24, 109.51], [20, 135], [22, 150], [20, 165], [18, 175], [15, 160], [18.24, 109.51]], color: '#d0f4de', name: 'Chinese Hawaii Approaches' },
                    { coords: [[18.24, 109.51], [25, 140], [35, 160], [45, 175], [50, -170], [40, 165], [18.24, 109.51]], color: '#d0f4de', name: 'Chinese Alaska Interdiction' },
                    { coords: [[18.24, 109.51], [10, 120], [0, 130], [-10, 140], [-15, 145], [-10, 135], [5, 125], [18.24, 109.51]], color: '#d0f4de', name: 'Chinese Australia Threat' }
                );
            }
            return pc;
        }

        function getCountryUmbrella(countryName) {
            umbrellaZones = getUmbrellaZones();  // refresh on scenario change
            if (umbrellaZones.us.includes(countryName)) return { color: 'rgba(59, 130, 246, 0.6)', name: 'U.S. Umbrella' };
            if (umbrellaZones.sinoRussian.includes(countryName)) return { color: 'rgba(22, 163, 74, 0.6)', name: 'Sino-Russian Bloc' };
            if (umbrellaZones.saudiPakistan.includes(countryName)) return { color: 'rgba(6, 182, 212, 0.6)', name: 'Saudi-Pakistan Umbrella' };
            if (umbrellaZones.israel.includes(countryName)) return { color: 'rgba(229, 231, 235, 0.6)', name: 'Israeli Arsenal' };
            if (umbrellaZones.india.includes(countryName)) return { color: 'rgba(180, 83, 9, 0.6)', name: 'Indian Arsenal' };
            return { color: 'rgba(30, 41, 55, 0.4)', name: 'Neutral' };
        }

        function switchScenario(scenario) {
            currentScenario = scenario;
            document.querySelectorAll('[id^="tab-"]').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${scenario}`).classList.add('active');
            umbrellaZones = getUmbrellaZones();  // important
            updateScenarioData();
            renderDashboard();
            updateGlobe();
            renderImplications();
        }

        function renderImplications() {
            const info = document.getElementById('scenarioInfo');
            let text = '';
            if (currentScenario === '2040') {
                text = `<h3 class="text-xl font-bold orbitron mb-4 text-orange-400">ðŸŽ¯ Strategic Implications: 2040 (60% US Reduction + Australia Lost)</h3>
                <div class="text-gray-300 space-y-4">
                <p><strong>U.S. nuclear umbrella collapses outside North America, Hawaii, and core NATO Europe</strong></p>
                <p><strong>Australia & New Zealand now under extended Sino-Russian nuclear umbrella</strong></p>
                <p><strong>China achieves full Western Pacific and Indian Ocean dominance</strong></p>
                <p><strong>Russia controls North Atlantic and Arctic</strong></p>
                <p><strong>Allies forced into independent postures or alignment shifts:</strong></p>
                <ul class="list-disc pl-5">
                    <li>Australia formally accepts Chinese protection</li>
                    <li>Japan, South Korea, Taiwan â†’ accelerated indigenous nuclear programs</li>
                    <li>Poland, Baltics â†’ rely on limited French/UK guarantees</li>
                    <li>Philippines, Thailand â†’ gravitate toward Beijing</li>
                </ul>
                <p><strong>U.S. Navy SSBN/SSN posture reduced to continental defense only</strong></p>
                <ul class="list-disc pl-5">
                    <li>No forward presence in Indian Ocean</li>
                    <li>Pacific SSBNs confined east of Hawaii</li>
                    <li>Atlantic SSBNs restricted to Western Atlantic</li>
                    <li>SSN ring defense around the Americas</li>
                </ul>
                <p><strong>UK & France maintain independent European/GIUK coverage</strong></p>
                </div>`;
            }
            // ... other scenarios unchanged
            info.innerHTML = text;
        }

        // Rest of script (initGlobe, updateGlobe, etc.) remains unchanged except it now correctly sees the new patrols and umbrella zones
    </script>
</body>
</html>
