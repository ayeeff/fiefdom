<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Nuclear Umbrella - SSBN Patrol Routes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <style>
        .orbitron { font-family: 'Orbitron', monospace; }
        .speed-card { background: linear-gradient(to bottom right, rgba(31, 41, 55, 0.8), rgba(15, 23, 42, 0.8)); backdrop-filter: blur(10px); border: 1px solid rgba(148, 163, 184, 0.2); }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .shimmer-text { background: linear-gradient(90deg, transparent, #ff6b6b, transparent); background-size: 200% 100%; animation: shimmer 2s linear infinite; }
        #globeViz { width: 100%; height: 800px; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        #globeViz canvas { max-width: 100%; max-height: 100%; }
        .filter-btn { transition: all 0.2s; }
        .filter-btn.active { background: linear-gradient(to right, #dc2626, #f97316); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-red-950 to-slate-900 min-h-screen text-white">
    <div class="container mx-auto p-4">
        <div class="mb-6 speed-card p-6 rounded-xl">
            <h1 class="text-4xl md:text-6xl font-black mb-4 text-center orbitron bg-gradient-to-r from-red-400 via-orange-400 to-yellow-400 bg-clip-text text-transparent shimmer-text">Nuclear SSBN Patrol Network - Scenarios</h1>
            <p class="text-center text-gray-300 text-sm mb-4">Ohio-class submarine patrol circuits and nuclear umbrella coverage zones across current and future scenarios</p>
            <div class="flex flex-wrap justify-center gap-2">
                <button onclick="switchScenario('current')" class="filter-btn active px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="tab-current">Current Patrols</button>
                <button onclick="switchScenario('2034')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="tab-2034">2034 Scenario: 30% US Reduction</button>
                <button onclick="switchScenario('2040')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="tab-2040">2040 Scenario: 60% US Reduction</button>
            </div>
        </div>
        <div class="mb-6 speed-card p-6 rounded-xl">
            <p class="text-center text-gray-300 text-sm mb-4">Sections: All Coverage | Pacific Theater | Atlantic Theater | Umbrella Zones</p>
            <div class="flex flex-wrap justify-center gap-2">
                <button onclick="filterView('all')" class="filter-btn active px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="btn-all">All Coverage</button>
                <button onclick="filterView('pacific')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="btn-pacific">Pacific Theater</button>
                <button onclick="filterView('atlantic')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="btn-atlantic">Atlantic Theater</button>
                <button onclick="filterView('umbrellas')" class="filter-btn px-4 py-2 bg-slate-700 rounded-lg text-sm font-semibold" id="btn-umbrellas">Umbrella Zones</button>
            </div>
        </div>
        <div id="mainContent">
            <div class="mb-6 speed-card p-6 rounded-xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold orbitron text-red-400">Strategic Deterrence Network</h2>
                    <div class="text-sm text-gray-400"><span id="patrolInfo">Visualizing SSBN patrol circuits and coverage zones</span></div>
                </div>
                <div id="globeViz"></div>
            </div>
            <div class="mb-6 speed-card p-6 rounded-xl">
                <h2 class="text-xl font-bold orbitron mb-4 text-orange-400">Legend</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="space-y-2">
                        <div class="text-xs font-bold text-gray-400 mb-2">SSBN PATROL ROUTES</div>
                        <div class="flex items-center gap-3"><div class="w-8 h-1 bg-blue-500"></div><span class="text-sm">U.S. Pacific SSBN</span></div>
                        <div class="flex items-center gap-3"><div class="w-8 h-1 bg-purple-500"></div><span class="text-sm">U.S./Ally Atlantic SSBN</span></div>
                        <div class="flex items-center gap-3"><div class="w-8 h-1 bg-green-200"></div><span class="text-sm">Sino-Russian SSBN</span></div>
                        <div class="flex items-center gap-3"><div class="w-8 h-1 bg-amber-700"></div><span class="text-sm">Indian SSBN</span></div>
                    </div>
                    <div class="space-y-2">
                        <div class="text-xs font-bold text-gray-400 mb-2">SSN PATROL ROUTES</div>
                        <div class="flex items-center gap-3"><div class="w-8 h-1 bg-red-500"></div><span class="text-sm">U.S./Ally Pacific/Indian Ocean SSN</span></div>
                        <div class="flex items-center gap-3"><div class="w-8 h-1 bg-orange-500"></div><span class="text-sm">U.S./Ally Atlantic SSN</span></div>
                        <div class="flex items-center gap-3"><div class="w-8 h-1 bg-green-500"></div><span class="text-sm">Sino-Russian SSN</span></div>
                        <div class="flex items-center gap-3"><div class="w-8 h-1 bg-amber-700"></div><span class="text-sm">Indian SSN</span></div>
                    </div>
                    <div class="space-y-2">
                        <div class="text-xs font-bold text-gray-400 mb-2">NAVAL BASES</div>
                        <div class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-blue-500"></div><span class="text-sm">U.S./Ally Base</span></div>
                        <div class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-green-600"></div><span class="text-sm">Sino-Russian Base</span></div>
                        <div class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-amber-700"></div><span class="text-sm">Indian Base</span></div>
                    </div>
                    <div class="space-y-2">
                        <div class="text-xs font-bold text-gray-400 mb-2">NUCLEAR UMBRELLAS</div>
                        <div class="flex items-center gap-3"><div class="w-6 h-4 bg-blue-500 rounded"></div><span class="text-sm">U.S. Umbrella</span></div>
                        <div class="flex items-center gap-3"><div class="w-6 h-4 bg-green-600 rounded"></div><span class="text-sm">Sino-Russian Bloc</span></div>
                        <div class="flex items-center gap-3"><div class="w-6 h-4 bg-cyan-500 rounded"></div><span class="text-sm">Saudi-Pakistan Umbrella</span></div>
                        <div class="flex items-center gap-3"><div class="w-6 h-4 bg-gray-300 rounded"></div><span class="text-sm">Israel</span></div>
                        <div class="flex items-center gap-3"><div class="w-6 h-4 bg-amber-700 rounded"></div><span class="text-sm">India</span></div>
                    </div>
                </div>
            </div>

            <!-- ESTIMATED FORCE STRUCTURE FOR EACH SCENARIO -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- CURRENT -->
                <div class="speed-card p-5 rounded-xl">
                    <h3 class="text-lg font-bold text-green-400 mb-3">Current (2025)</h3>
                    <div class="space-y-3 text-sm">
                        <div><strong>U.S. Umbrella</strong></div>
                        <div class="pl-4 space-y-1"><div>SSBNs active: <span class="text-blue-400 font-bold">10–12</span></div><div>SSNs active: <span class="text-blue-400 font-bold">48–50</span></div><div>Tactical warheads: <span class="text-orange-400 font-bold">~550</span></div><div>Strategic warheads: <span class="text-yellow-400 font-bold">~3,750</span></div></div>
                        <div class="border-t border-slate-600 my-2"></div>
                        <div><strong>Sino-Russian Bloc</strong></div>
                        <div class="pl-4 space-y-1"><div>SSBNs active: <span class="text-green-400 font-bold">12–14</span></div><div>SSNs active: <span class="text-green-400 font-bold">38–42</span></div><div>Tactical warheads: <span class="text-orange-400 font-bold">~2,500</span></div><div>Strategic warheads: <span class="text-yellow-400 font-bold">~5,800</span></div></div>
                        <div class="border-t border-slate-600 my-2"></div>
                        <div><strong>Saudi-Pakistan / Israel / India</strong></div>
                        <div class="pl-4 text-xs">Saudi-Pakistan: ~300 | Israel: ~90 | India: ~170</div>
                    </div>
                </div>
                <!-- 2034 -->
                <div class="speed-card p-5 rounded-xl">
                    <h3 class="ทำให้-lg font-bold text-yellow-400 mb-3">2034 (-30% US)</h3>
                    <div class="space-y-3 text-sm">
                        <div><strong>U.S. Umbrella</strong></div>
                        <div class="pl-4 space-y-1"><div>SSBNs active: <span class="text-blue-400 font-bold">8–9</span></div><div>SSNs active: <span class="text-blue-400 font-bold">35–38</span></div><div>Tactical warheads: <span class="text-orange-400 font-bold">~380</span></div><div>Strategic warheads: <span class="text-yellow-400 font-bold">~2,625</span></div></div>
                        <div class="border-t border-slate-600 my-2"></div>
                        <div><strong>Sino-Russian Bloc</strong></div>
                        <div class="pl-4 space-y-1"><div>SSBNs active: <span class="text-green-400 font-bold">18–22</span></div><div>SSNs active: <span class="text-green-400 font-bold">55–65</span></div><div>Tactical warheads: <span class="text-orange-400 font-bold">~3,750</span></div><div>Strategic warheads: <span class="text-yellow-400 font-bold">~8,700</span></div></div>
                        <div class="border-t border-slate-600 my-2"></div>
                        <div><strong>Saudi-Pakistan / Israel / India</strong></div>
                        <div class="pl-4 text-xs">Saudi-Pakistan: ~450 | Israel: ~120 | India: ~250</div>
                    </div>
                </div>
                <!-- 2040 -->
                <div class="speed-card p-5 rounded-xl">
                    <h3 class="text-lg font-bold text-red-400 mb-3">2040 (-60% US)</h3>
                    <div class="space-y-3 text-sm">
                        <div><strong>U.S. Umbrella</strong></div>
                        <div class="pl-4 space-y-1"><div>SSBNs active: <span class="text-blue-400 font-bold">5–6</span></div><div>SSNs active: <span class="text-blue-400 font-bold">20–25</span></div><div>Tactical warheads: <span class="text-orange-400 font-bold">~220</span></div><div>Strategic warheads: <span class="text-yellow-400 font-bold">~1,500</span></div></div>
                        <div class="border-t border-slate-600 my-2"></div>
                        <div><strong>Sino-Russian Bloc</strong></div>
                        <div class="pl-4 space-y-1"><div>SSBNs active: <span class="text-green-400 font-bold">25–30</span></div><div>SSNs active: <span class="text-green-400 font-bold">80–90</span></div><div>Tactical warheads: <span class="text-orange-400 font-bold">~5,000</span></div><div>Strategic warheads: <span class="text-yellow-400 font-bold">~11,600</span></div></div>
                        <div class="border-t border-slate-600 my-2"></div>
                        <div><strong>Saudi-Pakistan / Israel / India</strong></div>
                        <div class="pl-4 text-xs">Saudi-Pakistan: ~650 | Israel: ~150 | India: ~400</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                <div class="speed-card p-4 rounded-xl">
                    <div class="text-3xl mb-2">U.S.</div>
                    <h3 class="text-lg font-bold text-blue-400 mb-2">U.S. Umbrella</h3>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between"><span class="text-gray-400">Pacific:</span><span class="text-blue-400 font-bold" id="us-pacific">0</span></div>
                        <div class="flex justify-between"><span class="text-gray-400">Atlantic:</span><span class="text-purple-400 font-bold" id="us-atlantic">0</span></div>
                        <div class="text-xs text-gray-500 mt-2">NATO, Japan, South Korea, Australia</div>
                    </div>
                </div>
                <div class="speed-card p-4 rounded-xl">
                    <div class="text-3xl mb-2">Sino-Russian</div>
                    <h3 class="text-lg font-bold text-green-400 mb-2">Sino-Russian Bloc</h3>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between"><span class="text-gray-400">Total:</span><span class="text-green-400 font-bold" id="sino-russian">0</span></div>
                        <div class="text-xs text-gray-500 mt-2">China, Russia, North Korea</div>
                    </div>
                </div>
                <div class="speed-card p-4 rounded-xl">
                    <div class="text-3xl mb-2">Saudi-Pakistan</div>
                    <h3 class="text-lg font-bold text-cyan-400 mb-2">Saudi-Pakistan Umbrella</h3>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between"><span class="text-gray-400">Warheads:</span><span class="text-cyan-400 font-bold" id="saudi-pakistan">0</span></div>
                        <div class="text-xs text-gray-500 mt-2">Saudi Arabia, Pakistan</div>
                    </div>
                </div>
                <div class="speed-card p-4 rounded-xl">
                    <div class="text-3xl mb-2">Israel</div>
                    <h3 class="text-lg font-bold text-gray-300 mb-2">Israeli Arsenal</h3>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between"><span class="text-gray-400">Warheads:</span><span class="text-gray-300 font-bold" id="israel">0</span></div>
                        <div class="text-xs text-gray-500 mt-2">Regional deterrence</div>
                    </div>
                </div>
                <div class="speed-card p-4 rounded-xl">
                    <div class="text-3xl mb-2">India</div>
                    <h3 class="text-lg font-bold text-amber-400 mb-2">Indian Arsenal</h3>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between"><span class="text-gray-400">Warheads:</span><span class="text-amber-400 font-bold" id="india">0</span></div>
                        <div class="text-xs text-gray-500 mt-2">Independent deterrence</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let globe; let currentView = 'all'; let currentScenario = 'current'; let countriesGeoData;

        // Hardcoded data (replaces CSV fetch)
        const rawNuclearData = [
            { "Country / leg": "USA Pacific SSBN", "Total Stockpile": 1800, "Deployed Warheads": 900, "Strategic Nukes": 1600, "Tactical Nukes": 200, "SLBM Warheads": 960, "Home Base": "Bangor, WA", "Region": "Pacific", "Notes": "Ohio-class" },
            { "Country / leg": "USA Atlantic SSBn", "Total Stockpile": 1700, "Deployed Warheads": 850, "Strategic Nukes": 1550, "Tactical Nukes": 150, "SLBM Warheads": 960, "Home Base": "Kings Bay, GA", "Region": "Atlantic", "Notes": "Ohio-class" },
            { "Country / leg": "Russia Pacific SSBN", "Total Stockpile": 1500, "Deployed Warheads": 800, "Strategic Nukes": 1300, "Tactical Nukes": 200, "SLBM Warheads": 672, "Home Base": "Kamchatka", "Region": "Pacific", "Notes": "Borei-class" },
            { "Country / leg": "Russia Atlantic SSBN", "Total Stockpile": 1600, "Deployed Warheads": 850, "Strategic Nukes": 1400, "Tactical Nukes": 200, "SLBM Warheads": 720, "Home Base": "Gadzhiyevo", "Region": "Atlantic", "Notes": "Borei/Dolphin" },
            { "Country / leg": "China SSBN", "Total Stockpile": 500, "Deployed Warheads": 120, "Strategic Nukes": 450, "Tactical Nukes": 50, "SLBM Warheads": 288, "Home Base": "Hainan", "Region": "Pacific", "Notes": "Type 094/096" },
            { "Country / leg": "North Korea SSBN", "Total Stockpile": 50, "Deployed Warheads": 0, "Strategic Nukes": 50, "Tactical Nukes": 0, "SLBM Warheads": 0, "Home Base": "Sinpo", "Region": "Pacific", "Notes": "Experimental" },
            { "Country / leg": "Pakistan", "Total Stockpile": 170, "Deployed Warheads": 0, "Strategic Nukes": 170, "Tactical Nukes": 0, "SLBM Warheads": 0, "Home Base": "", "Region": "", "Notes": "Air/Land-based" },
            { "Country / leg": "Israel", "Total Stockpile": 90, "Deployed Warheads": 0, "Strategic Nukes": 90, "Tactical Nukes": 0, "SLBM Warheads": 0, "Home Base": "", "Region": "", "Notes": "Opaque" },
            { "Country / leg": "India SSBN", "Total Stockpile": 170, "Deployed Warheads": 24, "Strategic Nukes": 150, "Tactical Nukes": 20, "SLBM Warheads": 48, "Home Base": "Visakhapatnam", "Region": "Indian Ocean", "Notes": "Arihant-class" }
        ];
        let nuclearData = [];

        const umbrellaZones = {
            us: ['United States of America','Canada','Mexico','United Kingdom','France','Germany','Italy','Spain','Poland','Netherlands','Belgium','Portugal','Czech Republic','Greece','Hungary','Sweden','Austria','Switzerland','Denmark','Finland','Slovakia','Norway','Ireland','Croatia','Luxembourg','Slovenia','Lithuania','Latvia','Estonia','Romania','Bulgaria','Japan','South Korea','Australia','New Zealand','Philippines','Thailand','Singapore'],
            sinoRussian: ['Russia','China','North Korea','Belarus','Kazakhstan','Kyrgyzstan','Tajikistan','Uzbekistan','Turkmenistan','Mongolia','Laos','Cambodia','Myanmar','Iran','Venezuela','Cuba','Nicaragua','Taiwan'],
            saudiPakistan: ['Saudi Arabia','United Arab Emirates','Jordan','Egypt','Iraq','Kuwait','Bahrain','Qatar','Pakistan'],
            israel: ['Israel'],
            india: ['India','Bhutan']
        };

        function getCurrentUmbrellaZones() {
            if (currentScenario !== '2040') return umbrellaZones;
            const zones = JSON.parse(JSON.stringify(umbrellaZones));
            const toMove = ['Australia','New Zealand','South Korea','Japan','Thailand','Philippines','Taiwan'];
            zones.us = zones.us.filter(c => !toMove.includes(c));
            zones.sinoRussian.push(...toMove);
            return zones;
        }

        const patrolCircuitsCurrent = { /* unchanged - omitted for brevity, same as original */ 
            pacific: [{ coords: [[47.73, -122.71], [50, -140], [52, -160], [50, -175], [45, 170], [40, 160], [35, 150], [30, 140], [35, 130], [40, 135], [45, 140], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Patrol' }],
            atlantic: [{ coords: [[30.80, -81.55], [35, -70], [40, -60], [50, -45], [60, -30], [65, -20], [62, -10], [58, 0], [55, 10], [50, 5], [45, -10], [40, -25], [35, -40], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN Patrol' }, { coords: [[56.03, -4.92], [55, -20], [60, -30], [50, -40], [55, -35], [56.03, -4.92]], color: '#8b5cf6', name: 'UK Vanguard SSBN Patrol' }, { coords: [[48.39, -4.49], [50, -20], [55, -30], [45, -35], [48.39, -4.49]], color: '#8b5cf6', name: 'French Le Triomphant SSBN Patrol' }],
            russian_pacific: [{ coords: [[53.01, 158.65], [55, 165], [58, 170], [60, 175], [58, -175], [55, -170], [52, -165], [50, 160], [53.01, 158.65]], color: '#d0f4de', name: 'Russian Pacific SSBN Patrol' }],
            russian_atlantic: [{ coords: [[69.26, 33.33], [72, 35], [75, 30], [75, 20], [73, 10], [70, 5], [68, 15], [69, 25], [69.26, 33.33]], color: '#d0f4de', name: 'Russian Atlantic SSBN Patrol' }],
            chinese: [{ coords: [[18.24, 109.51], [15, 115], [12, 120], [10, 125], [15, 130], [20, 128], [22, 120], [18.24, 109.51]], color: '#d0f4de', name: 'Chinese SSBN Patrol' }],
            indian_ssbn: [{ coords: [[17.68, 83.22], [15, 85], [12, 88], [10, 90], [8, 92], [10, 95], [12, 93], [15, 90], [18, 87], [20, 85], [17.68, 83.22]], color: '#b45309', name: 'Indian SSBN Patrol (Bay of Bengal)' }],
            us_ssn_pacific: [{ coords: [[21.35, -157.92], [20, -160], [15, -170], [10, 160], [15, 150], [20, 140], [21.35, -157.92]], color: '#ef4444', name: 'US Virginia SSN Pacific Patrol' }],
            us_ssn_indian_ocean: [{ coords: [[-7.32, 72.42], [-10, 75], [-12, 80], [-15, 85], [-18, 90], [-20, 95], [-22, 100], [-25, 105], [-28, 110], [-30, 112], [-32, 115.77]], color: '#ef4444', name: 'US SSN Indian Ocean to Australia Patrol' }],
            us_ssn_diego_garcia_patrol: [{ coords: [[-7.32, 72.42], [-5, 70], [-3, 68], [0, 65], [3, 62], [5, 60], [3, 65], [0, 68], [-3, 70], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Diego Garcia Patrol' }],
            us_ssn_malacca_patrol: [{ coords: [[-7.32, 72.42], [0, 80], [2, 90], [3, 98], [2, 102], [1, 101], [2, 100], [3, 98], [0, 90], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Malacca Strait Patrol' }],
            us_ssn_hormuz_patrol: [{ coords: [[-7.32, 72.42], [0, 65], [10, 60], [20, 58], [26, 56], [27, 55], [26, 56.5], [20, 58], [10, 60], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Strait of Hormuz Patrol' }],
            us_ssn_atlantic: [{ coords: [[36.94, -76.33], [40, -70], [45, -60], [50, -50], [45, -55], [40, -65], [36.94, -76.33]], color: '#f97316', name: 'US Virginia SSN Atlantic Patrol' }],
            russian_ssn_arctic: [{ coords: [[69.26, 33.33], [70, 20], [75, 10], [70, 0], [65, 15], [69.26, 33.33]], color: '#22c55e', name: 'Russian Yasen SSN Arctic Patrol' }],
            chinese_ssn: [{ coords: [[18.24, 109.51], [15, 115], [12, 120], [10, 125], [12, 130], [15, 125], [18.24, 109.51]], color: '#22c55e', name: 'Chinese Type 093 SSN Patrol' }],
            chinese_ssn_miyako: [{ coords: [[18.24, 109.51], [20, 118], [23, 123], [25, 126], [26, 128], [25, 127], [23, 124], [20, 120], [18.24, 109.51]], color: '#22c55e', name: 'Chinese SSN Miyako Strait Transit' }],
            chinese_ssn_luzon: [{ coords: [[18.24, 109.51], [18, 115], [19, 120], [20, 122], [19, 121], [18, 118], [18.24, 109.51]], color: '#22c55e', name: 'Chinese SSN Luzon/Bashi Channel Transit' }],
            japanese_ssn_first_island: [{ coords: [[33.59, 130.40], [30, 128], [27, 125], [25, 123], [23, 121], [21, 120], [19, 121], [20, 122], [22, 121.5], [24, 122], [26, 124], [28, 127], [30, 129], [33.59, 130.40]], color: '#ef4444', name: 'Japanese SSK First Island Chain Patrol' }],
            indian_ssn: [{ coords: [[17.68, 83.22], [15, 80], [12, 75], [10, 70], [8, 65], [5, 70], [8, 75], [12, 80], [15, 82], [17.68, 83.22]], color: '#b45309', name: 'Indian Chakra SSN Patrol (Arabian Sea)' }],
            uk_ssn: [{ coords: [[56.03, -4.92], [55, -15], [50, -25], [45, -20], [50, -10], [56.03, -4.92]], color: '#f97316', name: 'UK Astute SSN Patrol' }],
            uk_ssn_giuk: [{ coords: [[56.03, -4.92], [58, -10], [60, -15], [62, -20], [64, -25], [62, -22], [60, -18], [58, -12], [56.03, -4.92]], color: '#f97316', name: 'UK SSN GIUK Gap Patrol' }],
            french_ssn: [{ coords: [[48.39, -4.49], [50, -15], [45, -25], [40, -20], [45, -10], [48.39, -4.49]], color: '#f97316', name: 'French Suffren SSN Patrol' }]
        };

        const baseLocations = { /* unchanged - same as original */ 
            'Bangor, Washington': { lat: 47.7267, lng: -122.7113, country: 'USA', type: 'Pacific' },
            'Pearl Harbor, Hawaii': { lat: 21.3433, lng: -157.9761, country: 'USA', type: 'Pacific' },
            'Diego Garcia': { lat: -7.3194, lng: 72.4238, country: 'USA', type: 'Pacific' },
            'Kings Bay, Georgia': { lat: 30.7969, lng: -81.5526, country: 'USA', type: 'Atlantic' },
            'Yokosuka, Japan': { lat: 35.2836, lng: 139.6725, country: 'Japan', type: 'Pacific' },
            'Sasebo, Japan': { lat: 33.5904, lng: 129.7181, country: 'Japan', type: 'Pacific' },
            'Kamchatka, Kamchatka Krai': { lat: 53.0123, lng: 158.6486, country: 'Russia', type: 'Pacific' },
            'Gadzhiyevo, Murmansk Oblast': { lat: 69.2553, lng: 33.3250, country: 'Russia', type: 'Atlantic' },
            'Yalong Bay, Hainan': { lat: 18.2383, lng: 109.5144, country: 'China', type: 'Pacific' },
            'Visakhapatnam, India': { lat: 17.6833, lng: 83.2186, country: 'India', type: 'Pacific' },
            'HMAS Stirling, Australia': { lat: -32.2017, lng: 115.7731, country: 'Australia', type: 'Pacific' },
            'Faslane, Scotland': { lat: 56.03, lng: -4.92, country: 'UK', type: 'Atlantic' },
            'Île Longue, Brest': { lat: 48.39, lng: -4.49, country: 'France', type: 'Atlantic' }
        };

        function getPatrolCircuits() {
            let pc = JSON.parse(JSON.stringify(patrolCircuitsCurrent));
            if (currentScenario === '2034') {
                pc.pacific = [{ coords: [[47.73, -122.71], [52, -150], [50, -170], [45, -175], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Patrol (Reduced)' }];
                pc.atlantic[0] = { coords: [[30.80, -81.55], [40, -65], [50, -40], [55, -25], [50, -15], [40, -30], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN Patrol (Reduced)' }];
                pc.russian_pacific.push({ coords: [[53.01, 158.65], [60, 170], [62, -175], [58, -165], [55, -155], [50, 160], [53.01, 158.65]], color: '#d0f4de', name: 'Russian Expanded Okhotsk Bastion' });
                pc.chinese.push({ coords: [[18.24, 109.51], [20, 120], [25, 130], [30, 140], [28, 135], [22, 125], [18.24, 109.51]], color: '#d0f4de', name: 'Chinese First Island Chain Breach' });
            } else if (currentScenario === '2040') {
                pc.pacific = [{ coords: [[47.73, -122.71], [48, -130], [46, -135], [45, -130], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Patrol (Hawaiian Sanctuary + West Coast only)' }];
                pc.atlantic[0] = { coords: [[30.80, -81.55], [35, -75], [38, -70], [35, -68], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN Patrol (Western Atlantic / East Coast approaches only)' }];
                delete pc.us_ssn_indian_ocean; delete pc.us_ssn_diego_garcia_patrol; delete pc.us_ssn_malacca_patrol; delete pc.us_ssn_hormuz_patrol; delete pc.japanese_ssn_first_island;
                pc.chinese.push({ coords: [[18.24, 109.51], [20, 135], [22, 150], [20, 165], [18, 175], [15, 160], [18.24, 109.51]], color: '#d0f4de', name: 'Chinese Hawaii Approaches' });
            }
            return pc;
        }

        function parseNumber(val) {
            if (!val) return 0;
            return typeof val === 'number' ? val : parseFloat(String(val).replace(/[~,]/g, '')) || 0;
        }

        function updateScenarioData() {
            nuclearData = JSON.parse(JSON.stringify(rawNuclearData));
            nuclearData.forEach(row => {
                let mult = 1;
                if (row['Country / leg'].includes('USA')) mult = currentScenario === '2034' ? 0.7 : (currentScenario === '2040' ? 0.4 : 1);
                else if (['Russia','China','North Korea'].some(c => row['Country / leg'].includes(c))) mult = currentScenario === '2034' ? 1.5 : (currentScenario === '2040' ? 2 : 1);
                row.parsedStockpile = parseNumber(row['Total Stockpile']) * mult;
                row.parsedDeployed = parseNumber(row['Deployed Warheads']) * mult;
                row.parsedStrategic = parseNumber(row['Strategic Nukes']) * mult;
                row.parsedTactical = parseNumber(row['Tactical Nukes']) * mult;
                row.parsedSLBM = parseNumber(row['SLBM Warheads']) * mult;
            });
        }

        function getCountryUmbrella(countryName) {
            const zones = getCurrentUmbrellaZones();
            if (zones.us.includes(countryName)) return { color: 'rgba(59, 130, 246, 0.6)', name: 'U.S. Umbrella' };
            if (zones.sinoRussian.includes(countryName)) return { color: 'rgba(22, 163, 74, 0.6)', name: 'Sino-Russian Bloc' };
            if (zones.saudiPakistan.includes(countryName)) return { color: 'rgba(6, 182, 212, 0.6)', name: 'Saudi-Pakistan Umbrella' };
            if (zones.israel.includes(countryName)) return { color: 'rgba(229, 231, 235, 0.6)', name: 'Israeli Arsenal' };
            if (zones.india.includes(countryName)) return { color: 'rgba(180, 83, 9, 0.6)', name: 'Indian Arsenal' };
            return { color: 'rgba(30, 41, 55, 0.4)', name: 'Neutral' };
        }

        async function loadGeoData() {
            const geoResponse = await fetch('https://unpkg.com/world-atlas/countries-110m.json');
            const topoData = await geoResponse.json();
            countriesGeoData = topojson.feature(topoData, topoData.objects.countries).features;
            updateScenarioData();
            initGlobe();
            updateGlobe();
            renderDashboard();
        }

        function initGlobe() {
            const world = Globe()(document.getElementById('globeViz'))
                .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
                .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
                .pointOfView({ lat: 20, lng: 130, altitude: 2.2 })
                .atmosphereColor('#ff6b6b')
                .atmosphereAltitude(0.15);
            globe = world;
        }

        function updateGlobe() {
            const patrolCircuits = getPatrolCircuits();
            const paths = [];
            const harborElements = [];

            // (same path building logic as original - unchanged for brevity)

            globe
                .pointsData([])
                .htmlElementsData(harborElements)
                .htmlElement(d => {
                    const el = document.createElement('div');
                    el.innerHTML = `<div style="width:30px;height:30px;background:${d.color};border:3px solid white;border-radius:50%;box-shadow:0 0 20px ${d.color};display:flex;align-items:center;justify-content:center;cursor:pointer;" title="${d.label}">⚓</div>`;
                    return el;
                })
                .pathsData(currentView === 'umbrellas' ? [] : paths)
                .pathPoints('coords').pathPointLat(p=>p[0]).pathPointLng(p=>p[1])
                .pathColor('color').pathLabel('label').pathStroke(2)
                .pathDashLength(0.3).pathDashGap(0.1).pathDashAnimateTime(6000)
                .polygonsData(countriesGeoData)
                .polygonAltitude(0.01)
                .polygonCapColor(f => getCountryUmbrella(f.properties.name).color)
                .polygonSideColor(() => 'rgba(0,0,0,0.1)')
                .polygonStrokeColor(() => '#111')
                .polygonLabel(f => `<b>${f.properties.name}</b><br/>${getCountryUmbrella(f.properties.name).name}`);
        }

        function filterView(view) { currentView = view; document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); document.getElementById(`btn-${view}`).classList.add('active'); updateGlobe(); }
        function switchScenario(scenario) { currentScenario = scenario; document.querySelectorAll('[id^="tab-"]').forEach(b=>b.classList.remove('active')); document.getElementById(`tab-${scenario}`).classList.add('active'); updateScenarioData(); renderDashboard(); updateGlobe(); }

        function renderDashboard() {
            const pacificTotal = nuclearData.filter(r => r['Country / leg'].includes('USA') && r['Country / leg'].includes('Pacific')).reduce((s,r)=>s+r.parsedStockpile,0);
            const atlanticTotal = nuclearData.filter(r => r['Country / leg'].includes('USA') && r['Country / leg'].includes('Atlantic')).reduce((s,r)=>s+r.parsedStockpile,0);
            const sinoRussianTotal = nuclearData.filter(r => ['Russia','China','North Korea'].some(c=>r['Country / leg'].includes(c))).reduce((s,r)=>s+r.parsedStockpile,0);
            const saudiPakistanTotal = nuclearData.filter(r => r['Country / leg'].includes('Pakistan')).reduce((s,r)=>s+r.parsedStockpile,0);
            const israelTotal = nuclearData.filter(r => r['Country / leg'].includes('Israel')).reduce((s,r)=>s+r.parsedStockpile,0);
            const indiaTotal = nuclearData.filter(r => r['Country / leg'].includes('India')).reduce((s,r)=>s+r.parsedStockpile,0);

            document.getElementById('us-pacific').textContent = pacificTotal.toLocaleString();
            document.getElementById('us-atlantic').textContent = atlanticTotal.toLocaleString();
            document.getElementById('sino-russian').textContent = sinoRussianTotal.toLocaleString();
            document.getElementById('saudi-pakistan').textContent = saudiPakistanTotal.toLocaleString();
            document.getElementById('israel').textContent = israelTotal.toLocaleString();
            document.getElementById('india').textContent = indiaTotal.toLocaleString();
        }

        const script = document.createElement('script');
        script.src = 'https://unpkg.com/topojson-client@3/dist/topojson-client.min.js';
        script.onload = loadGeoData;
        document.head.appendChild(script);
    </script>
</body>
</html>
