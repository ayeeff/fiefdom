<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam Hardware Supply Chain Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-2xl p-8 mb-6">
            <h1 class="text-4xl font-bold text-white mb-2">Steam Hardware Supply Chain</h1>
            <p class="text-blue-100">Manufacturing & R&D Network Across China</p>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white/10 backdrop-blur-lg rounded-lg p-6 border border-white/20">
                <div class="text-3xl font-bold text-blue-400 mb-2">5</div>
                <div class="text-sm text-gray-300">Manufacturing Sites</div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-lg p-6 border border-white/20">
                <div class="text-3xl font-bold text-purple-400 mb-2">3</div>
                <div class="text-sm text-gray-300">Provinces</div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-lg p-6 border border-white/20">
                <div class="text-3xl font-bold text-green-400 mb-2">4+</div>
                <div class="text-sm text-gray-300">Product Lines</div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-lg p-6 border border-white/20">
                <div class="text-3xl font-bold text-yellow-400 mb-2">1M</div>
                <div class="text-sm text-gray-300">Unit Capacity</div>
            </div>
        </div>

        <!-- Geographic Distribution Map -->
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 mb-6">
            <h2 class="text-xl font-bold text-white mb-4">Geographic Distribution - China Manufacturing Sites</h2>
            <div id="mapContainer" class="h-96 rounded-lg overflow-hidden"></div>
        </div>

        <!-- Production Focus Chart -->
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 mb-6">
            <h2 class="text-xl font-bold text-white mb-4">Production Focus by Site</h2>
            <div id="productChart" class="h-96"></div>
        </div>

        <!-- Site Details Table -->
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 mb-6">
            <h2 class="text-xl font-bold text-white mb-4">Manufacturing Site Details</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="text-xs uppercase bg-white/5">
                        <tr>
                            <th class="px-4 py-3 text-blue-300">Site</th>
                            <th class="px-4 py-3 text-blue-300">Location</th>
                            <th class="px-4 py-3 text-blue-300">Province</th>
                            <th class="px-4 py-3 text-blue-300">Product Focus</th>
                            <th class="px-4 py-3 text-blue-300">Key Notes</th>
                        </tr>
                    </thead>
                    <tbody id="siteTable" class="text-gray-200">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Provincial Distribution -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <h2 class="text-xl font-bold text-white mb-4">Sites by Province</h2>
                <div id="provinceChart" class="h-80"></div>
            </div>

            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <h2 class="text-xl font-bold text-white mb-4">Product Category Distribution</h2>
                <div id="categoryChart" class="h-80"></div>
            </div>
        </div>
    </div>

    <script>
        // Supply chain data
        const sites = [
            {
                name: "Dongguan Songshan Lake",
                province: "Guangdong",
                city: "Dongguan",
                lat: 23.05,
                lon: 113.74,
                products: ["Steam Deck", "Steam Frame", "Future Handhelds"],
                capacity: "100k-1M units",
                notes: "Primary Deck production base, 4000+ tech firms"
            },
            {
                name: "Shenzhen Bao'an",
                province: "Guangdong",
                city: "Shenzhen",
                lat: 22.64,
                lon: 113.81,
                products: ["Steam Controller", "Prototype PCBA"],
                capacity: "50k-500k units",
                notes: "30k+ factories, 24h component turnaround"
            },
            {
                name: "Suzhou Industrial Park",
                province: "Jiangsu",
                city: "Suzhou",
                lat: 31.32,
                lon: 120.72,
                products: ["SSD Modules", "Storage Components"],
                capacity: "High-reliability",
                notes: "ISO-13485 clean rooms, medical-grade quality"
            },
            {
                name: "Shenzhen Nanshan",
                province: "Guangdong",
                city: "Shenzhen",
                lat: 22.56,
                lon: 113.97,
                products: ["R&D", "EVT/DVT Prototypes"],
                capacity: "Prototype",
                notes: "Co-located with Tencent/DJI/Huawei"
            },
            {
                name: "Tianjin THATIC",
                province: "Tianjin",
                city: "Tianjin",
                lat: 39.09,
                lon: 117.70,
                products: ["Server CPUs", "Embedded CPUs"],
                capacity: "Not Deck APU",
                notes: "AMD 51% JV, Entity List 2019"
            }
        ];

        // Create Leaflet map
        const map = L.map('mapContainer').setView([28, 115], 5);
        
        // Add OpenStreetMap tiles with dark theme
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
            maxZoom: 19
        }).addTo(map);

        // Custom marker colors
        const colors = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];
        
        // Add markers for each site
        sites.forEach((site, index) => {
            const markerHtml = `
                <div style="
                    background-color: ${colors[index]};
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    border: 3px solid white;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                "></div>
            `;
            
            const customIcon = L.divIcon({
                html: markerHtml,
                className: 'custom-marker',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });
            
            const popupContent = `
                <div style="color: #1e293b; min-width: 200px;">
                    <h3 style="font-weight: bold; margin-bottom: 8px; color: ${colors[index]};">${site.name}</h3>
                    <p style="margin: 4px 0;"><strong>Location:</strong> ${site.city}, ${site.province}</p>
                    <p style="margin: 4px 0;"><strong>Products:</strong> ${site.products.join(', ')}</p>
                    <p style="margin: 4px 0;"><strong>Capacity:</strong> ${site.capacity}</p>
                    <p style="margin: 4px 0; font-size: 12px;">${site.notes}</p>
                </div>
            `;
            
            L.marker([site.lat, site.lon], { icon: customIcon })
                .bindPopup(popupContent)
                .addTo(map);
        });

        // Product focus horizontal bar chart
        const productData = [{
            type: 'bar',
            orientation: 'h',
            y: sites.map(s => s.name),
            x: [5, 4, 3, 4, 2],
            text: sites.map(s => s.products.join(', ')),
            textposition: 'auto',
            marker: {
                color: ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'],
                line: {
                    color: 'white',
                    width: 1
                }
            }
        }];

        const productLayout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            margin: { t: 20, b: 40, l: 150, r: 20 },
            xaxis: {
                title: 'Product Lines',
                color: 'white',
                gridcolor: 'rgba(255,255,255,0.1)'
            },
            yaxis: {
                color: 'white'
            },
            font: { color: 'white' }
        };

        Plotly.newPlot('productChart', productData, productLayout, {responsive: true});

        // Province pie chart
        const provinceCounts = {};
        sites.forEach(s => {
            provinceCounts[s.province] = (provinceCounts[s.province] || 0) + 1;
        });

        const provinceData = [{
            type: 'pie',
            labels: Object.keys(provinceCounts),
            values: Object.values(provinceCounts),
            marker: {
                colors: ['#3b82f6', '#10b981', '#f59e0b']
            },
            textinfo: 'label+percent',
            textfont: { color: 'white', size: 14 }
        }];

        const provinceLayout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            margin: { t: 20, b: 20, l: 20, r: 20 },
            showlegend: true,
            legend: {
                font: { color: 'white' }
            }
        };

        Plotly.newPlot('provinceChart', provinceData, provinceLayout, {responsive: true});

        // Category distribution
        const categories = {
            'Assembly': ['Deck', 'Frame', 'Handhelds'],
            'Controllers': ['Controller', 'PCBA'],
            'Storage': ['SSD', 'Modules'],
            'R&D': ['Prototypes', 'EVT/DVT'],
            'Compute': ['CPUs', 'Server']
        };

        const categoryData = [{
            type: 'bar',
            x: Object.keys(categories),
            y: [3, 2, 2, 2, 1],
            marker: {
                color: ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444']
            }
        }];

        const categoryLayout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            margin: { t: 20, b: 60, l: 60, r: 20 },
            xaxis: {
                title: 'Product Category',
                color: 'white',
                tickangle: -45
            },
            yaxis: {
                title: 'Product Lines',
                color: 'white',
                gridcolor: 'rgba(255,255,255,0.1)'
            },
            font: { color: 'white' }
        };

        Plotly.newPlot('categoryChart', categoryData, categoryLayout, {responsive: true});

        // Populate table
        const tableBody = document.getElementById('siteTable');
        sites.forEach(site => {
            const row = document.createElement('tr');
            row.className = 'border-b border-white/10 hover:bg-white/5';
            row.innerHTML = `
                <td class="px-4 py-3 font-medium">${site.name}</td>
                <td class="px-4 py-3">${site.city}</td>
                <td class="px-4 py-3">${site.province}</td>
                <td class="px-4 py-3">${site.products.join(', ')}</td>
                <td class="px-4 py-3 text-xs">${site.notes}</td>
            `;
            tableBody.appendChild(row);
        });
    </script>
</body>
</html>
