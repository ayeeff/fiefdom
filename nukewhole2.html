<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuclear Umbrella Collapse · 2025–2040</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <style>
        body { margin:0; background:#000; overflow:hidden; display:flex; justify-content:center; align-items:center; min-height:100vh; }
        .orbitron { font-family: 'Orbitron', sans-serif; }
        .card { background: rgba(30,41,55,0.92); backdrop-filter: blur(12px); border: 1px solid rgba(100,116,139,0.3); }
        @keyframes glow { 0%,100% { text-shadow: 0 0 20px #ff006e; } 50% { text-shadow: 0 0 40px #ff006e, 0 0 60px #ff006e; } }
        h1 { animation: glow 4s infinite; }
        .tab.active { background: linear-gradient(135deg, #dc2626, #f97316); box-shadow: 0 0 30px rgba(239,68,68,0.6); }
        .view-btn.active { background: #1e40af; box-shadow: 0 0 20px rgba(59,130,246,0.7); }
        #globeViz { width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<div id="globeViz"></div>

<!-- Title + Year Tabs -->
<div class="fixed top-4 left-1/2 -translate-x-1/2 z-10 text-center">
    <h1 class="text-5xl md:text-7xl font-black orbitron bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 bg-clip-text text-transparent">
        NUCLEAR UMBRELLA COLLAPSE
    </h1>
    <div class="flex justify-center gap-4 mt-6 flex-wrap">
        <button onclick="setYear('current')" class="tab active px-6 py-3 rounded-lg text-lg font-bold" id="tab-current">2025</button>
        <button onclick="setYear('2034')" class="tab px-6 py-3 rounded-lg text-lg font-bold" id="tab-2034">2034</button>
        <button onclick="setYear('2040')" class="tab px-6 py-3 rounded-lg text-lg font-bold" id="tab-2040">2040</button>
    </div>
</div>

<!-- Warhead Counter HUD -->
<div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-10 card p-6 rounded-2xl shadow-2xl">
    <div class="grid grid-cols-5 gap-6 text-center text-sm">
        <div><div class="text-4xl font-black text-blue-400" id="us-warheads">-</div><div class="text-gray-400">US Total</div></div>
        <div><div class="text-4xl font-black text-green-400" id="rc-warheads">-</div><div class="text-gray-400">RU+CN</div></div>
        <div><div class="text-4xl font-black text-gray-500" id="sp-warheads">-</div><div class="text-gray-400">PK/SA</div></div>
        <div><div class="text-4xl font-black text-white" id="il-warheads">-</div><div class="text-gray-400">Israel</div></div>
        <div><div class="text-4xl font-black text-amber-700" id="in-warheads">-</div><div class="text-gray-400">India</div></div>
    </div>
</div>

<!-- Implications Panel -->
<div class="fixed bottom-8 right-8 max-w-sm card p-6 rounded-2xl text-sm leading-relaxed" id="implications">
    <h3 class="text-xl font-bold text-yellow-400">2025: Full U.S. Extended Deterrence</h3>
    <p class="text-gray-300 mt-2">Global SSBN/SSN presence maintains credible second-strike coverage over allies in Europe and Asia.</p>
</div>

<script>
let globe, currentYear = 'current', currentView = 'all';

// ==================== FORCE DATA ====================
const forceData = {
    current: { us: 5244, rc: 7420, sp: 350, il: 90, in: 170 },
    '2034': { us: 3660, rc: 11130, sp: 500, il: 110, in: 250 },
    '2040': { us: 2100, rc: 18500, sp: 700, il: 130, in: 400 }
};

// ==================== UMBRELLA ZONES ====================
const baseUmbrellas = {
    us: ['United States of America','Canada','Mexico','United Kingdom','France','Germany','Italy','Spain','Poland','Netherlands','Belgium','Portugal','Czech Republic','Greece','Hungary','Sweden','Austria','Switzerland','Denmark','Finland','Slovakia','Norway','Ireland','Croatia','Luxembourg','Slovenia','Lithuania','Latvia','Estonia','Romania','Bulgaria','Japan','South Korea','Australia','New Zealand','Philippines','Thailand','Singapore'],
    sinoRussian: ['Russia','China','North Korea','Belarus','Kazakhstan','Kyrgyzstan','Tajikistan','Uzbekistan','Turkmenistan','Mongolia','Laos','Cambodia','Myanmar','Iran','Venezuela','Cuba','Nicaragua'],
    saudiPakistan: ['Saudi Arabia','United Arab Emirates','Jordan','Egypt','Iraq','Kuwait','Bahrain','Qatar','Pakistan'],
    israel: ['Israel'],
    india: ['India','Bhutan']
};

function getUmbrellaZones() {
    const z = JSON.parse(JSON.stringify(baseUmbrellas));

    if (currentYear === '2034' || currentYear === '2040') {
        // 2034: Taiwan + Philippines fall under Sino-Russian umbrella
        const earlyFlip = ['Taiwan', 'Philippines'];
        z.us = z.us.filter(c => !earlyFlip.includes(c));
        z.sinoRussian.push(...earlyFlip);
    }

    if (currentYear === '2040') {
        // 2040: Full collapse — the remaining major allies flip
        const lateFlip = ['Australia', 'New Zealand', 'South Korea', 'Japan', 'Thailand', 'Singapore'];
        z.us = z.us.filter(c => !lateFlip.includes(c));
        z.sinoRussian.push(...lateFlip);
    }

    return z;
}

function getCountryUmbrella(name) {
    const z = getUmbrellaZones();
    if (z.us.includes(name)) return {col: 'rgba(59,130,246,0.7)', name: 'U.S. Umbrella'};
    if (z.sinoRussian.includes(name)) return {col: 'rgba(34,197,94,0.85)', name: 'Sino-Russian Bloc'};
    if (z.saudiPakistan.includes(name)) return {col: 'rgba(6,182,212,0.7)', name: 'Saudi-Pakistan Axis'};
    if (z.israel.includes(name)) return {col: 'rgba(229,231,235,0.9)', name: 'Israel'};
    if (z.india.includes(name)) return {col: 'rgba(180,83,9,0.8)', name: 'India'};
    return {col: 'rgba(60,60,80,0.4)', name: 'Neutral'};
}

// ==================== FULL PATROL CIRCUITS (2025 baseline) ====================
    
const patrolCircuitsCurrent = {
    pacific: [{ coords: [[47.73, -122.71], [50, -140], [52, -160], [50, -175], [45, 170], [40, 160], [35, 150], [30, 140], [35, 130], [40, 135], [45, 140], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Patrol' }],
    atlantic: [
        { coords: [[30.80, -81.55], [35, -70], [40, -60], [50, -45], [60, -30], [65, -20], [62, -10], [58, 0], [55, 10], [50, 5], [45, -10], [40, -25], [35, -40], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN Patrol' },
        { coords: [[56.03, -4.92], [55, -20], [60, -30], [50, -40], [55, -35], [56.03, -4.92]], color: '#8b5cf6', name: 'UK Vanguard SSBN Patrol' },
        { coords: [[48.39, -4.49], [50, -20], [55, -30], [45, -35], [48.39, -4.49]], color: '#8b5cf6', name: 'French Le Triomphant SSBN Patrol' }
    ],
    russian_pacific: [{ coords: [[53.01, 158.65], [55, 165], [58, 170], [60, 175], [58, -175], [55, -170], [52, -165], [50, 160], [53.01, 158.65]], color: '#94a3b8', name: 'Russian Pacific SSBN Patrol' }],
    russian_atlantic: [{ coords: [[69.26, 33.33], [72, 35], [75, 30], [75, 20], [73, 10], [70, 5], [68, 15], [69, 25], [69.26, 33.33]], color: '#94a3b8', name: 'Russian Atlantic SSBN Patrol' }],
    chinese: [{ coords: [[18.24, 109.51], [15, 115], [12, 120], [10, 125], [15, 130], [20, 128], [22, 120], [18.24, 109.51]], color: '#94a3b8', name: 'Chinese SSBN Patrol' }],
    indian_ssbn: [{ coords: [[17.68, 83.22], [15, 85], [12, 88], [10, 90], [8, 92], [10, 95], [12, 93], [15, 90], [18, 87], [20, 85], [17.68, 83.22]], color: '#b45309', name: 'Indian SSBN Patrol (Bay of Bengal)' }],
    us_ssn_pacific: [{ coords: [[21.35, -157.92], [20, -160], [15, -170], [10, 160], [15, 150], [20, 140], [21.35, -157.92]], color: '#ef4444', name: 'US Virginia SSN Pacific Patrol' }],
    us_ssn_indian_ocean: [{ coords: [[-7.32, 72.42], [-10, 75], [-12, 80], [-15, 85], [-18, 90], [-20, 95], [-22, 100], [-25, 105], [-28, 110], [-30, 112], [-32, 115.77]], color: '#ef4444', name: 'US SSN Indian Ocean to Australia Patrol' }],
    us_ssn_diego_garcia_patrol: [{ coords: [[-7.32, 72.42], [-5, 70], [-3, 68], [0, 65], [3, 62], [5, 60], [3, 65], [0, 68], [-3, 70], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Diego Garcia Patrol' }],
    us_ssn_malacca_patrol: [{ coords: [[-7.32, 72.42], [0, 80], [2, 90], [3, 98], [2, 102], [1, 101], [2, 100], [3, 98], [0, 90], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Malacca Strait Patrol' }],
    us_ssn_hormuz_patrol: [{ coords: [[-7.32, 72.42], [0, 65], [10, 60], [20, 58], [26, 56], [27, 55], [26, 56.5], [20, 58], [10, 60], [-7.32, 72.42]], color: '#ef4444', name: 'US SSN Strait of Hormuz Patrol' }],
    us_ssn_atlantic: [{ coords: [[36.94, -76.33], [40, -70], [45, -60], [50, -50], [45, -55], [40, -65], [36.94, -76.33]], color: '#f97316', name: 'US Virginia SSN Atlantic Patrol' }],
    russian_ssn_arctic: [{ coords: [[69.26, 33.33], [70, 20], [75, 10], [70, 0], [65, 15], [69.26, 33.33]], color: '#22c55e', name: 'Russian Yasen SSN Arctic Patrol' }],
    chinese_ssn: [{ coords: [[18.24, 109.51], [15, 115], [12, 120], [10, 125], [12, 130], [15, 125], [18.24, 109.51]], color: '#22c55e', name: 'Chinese Type 093 SSN Patrol' }],
    chinese_ssn_miyako: [{ coords: [[18.24, 109.51], [20, 118], [23, 123], [25, 126], [26, 128], [25, 127], [23, 124], [20, 120], [18.24, 109.51]], color: '#22c55e', name: 'Chinese SSN Miyako Strait Transit' }],
    chinese_ssn_luzon: [{ coords: [[18.24, 109.51], [18, 115], [19, 120], [20, 122], [19, 121], [18, 118], [18.24, 109.51]], color: '#22c55e', name: 'Chinese SSN Luzon/Bashi Channel Transit' }],
    japanese_ssn_first_island: [{ coords: [[33.59, 130.40], [30, 128], [27, 125], [25, 123], [23, 121], [21, 120], [19, 121], [20, 122], [22, 121.5], [24, 122], [26, 124], [28, 127], [30, 129], [33.59, 130.40]], color: '#ef4444', name: 'Japanese SSK First Island Chain Patrol' }],
    indian_ssn: [{ coords: [[17.68, 83.22], [15, 80], [12, 75], [10, 70], [8, 65], [5, 70], [8, 75], [12, 80], [15, 82], [17.68, 83.22]], color: '#b45309', name: 'Indian Chakra SSN Patrol (Arabian Sea)' }],
    uk_ssn: [{ coords: [[56.03, -4.92], [55, -15], [50, -25], [45, -20], [50, -10], [56.03, -4.92]], color: '#f97316', name: 'UK Astute SSN Patrol' }],
    uk_ssn_giuk: [{ coords: [[56.03, -4.92], [58, -10], [60, -15], [62, -20], [64, -25], [62, -22], [60, -18], [58, -12], [56.03, -4.92]], color: '#f97316', name: 'UK SSN GIUK Gap Patrol' }],
    french_ssn: [{ coords: [[48.39, -4.49], [50, -15], [45, -25], [40, -20], [45, -10], [48.39, -4.49]], color: '#f97316', name: 'French Suffren SSN Patrol' }]
};

// ==================== DYNAMIC PATROL CHANGES BY YEAR ====================
    
function getPatrolCircuits() {
    let pc = JSON.parse(JSON.stringify(patrolCircuitsCurrent));

    if (currentYear === '2034') {
        // 2034: 30% US cut → reduced patrols, Sino-Russian expansion
        pc.pacific = [{ coords: [[47.73, -122.71], [52, -150], [50, -170], [45, -175], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN Patrol (Reduced)' }];
        pc.atlantic[0] = { coords: [[30.80, -81.55], [40, -65], [50, -40], [55, -25], [50, -15], [40, -30], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN Patrol (Reduced)' };

        pc.russian_pacific.push(
            { coords: [[53.01, 158.65], [60, 170], [62, -175], [58, -165], [55, -155], [50, 160], [53.01, 158.65]], color: '#94a3b8', name: 'Russian Expanded Okhotsk Bastion' },
            { coords: [[53.01, 158.65], [48, 155], [45, 165], [42, 175], [45, 170], [50, 160], [53.01, 158.65]], color: '#94a3b8', name: 'Russian Kuril Island Forward' }
        );
        pc.chinese.push(
            { coords: [[18.24, 109.51], [20, 120], [25, 130], [30, 140], [28, 135], [22, 125], [18.24, 109.51]], color: '#94a3b8', name: 'Chinese First Island Chain Breach' },
            { coords: [[18.24, 109.51], [15, 125], [10, 140], [5, 150], [10, 155], [15, 145], [18.24, 109.51]], color: '#94a3b8', name: 'Chinese Second Island Chain Push' }
        );
        pc.russian_atlantic.push(
            { coords: [[69.26, 33.33], [70, 20], [68, 5], [65, -10], [62, -20], [65, 0], [69.26, 33.33]], color: '#94a3b8', name: 'Russian GIUK Gap Penetration' },
            { coords: [[69.26, 33.33], [72, 10], [70, -5], [65, -15], [60, -25], [65, -10], [69.26, 33.33]], color: '#94a3b8', name: 'Russian North Atlantic Expansion' }
        );

    } else if (currentYear === '2040') {
        // 2040: 60% US cut → total collapse of forward presence
        pc.pacific = [{ coords: [[47.73, -122.71], [48, -130], [46, -135], [45, -130], [47.73, -122.71]], color: '#3b82f6', name: 'U.S. Pacific SSBN (Hawaiian Sanctuary + West Coast only)' }];
        pc.atlantic[0] = { coords: [[30.80, -81.55], [35, -75], [38, -70], [35, -68], [30.80, -81.55]], color: '#8b5cf6', name: 'U.S. Atlantic SSBN (Western Atlantic only)' };

        // Remove all US Indian Ocean & allied forward SSN presence
        delete pc.us_ssn_indian_ocean;
        delete pc.us_ssn_diego_garcia_patrol;
        delete pc.us_ssn_malacca_patrol;
        delete pc.us_ssn_hormuz_patrol;
        delete pc.japanese_ssn_first_island;

        // Chinese forward deployment
        pc.chinese.push(
            { coords: [[18.24, 109.51], [20, 135], [22, 150], [20, 165], [18, 175], [15, 160], [18.24, 109.51]], color: '#94a3b8', name: 'Chinese Hawaii Approaches' },
            { coords: [[18.24, 109.51], [25, 140], [35, 160], [45, 175], [50, -170], [40, 165], [18.24, 109.51]], color: '#94a3b8', name: 'Chinese Alaska Interdiction' },
            { coords: [[18.24, 109.51], [10, 120], [0, 130], [-10, 140], [-15, 145], [-10, 135], [5, 125], [18.24, 109.51]], color: '#94a3b8', name: 'Chinese Australia Threat' },
            { coords: [[18.24, 109.51], [20, 120], [25, 130], [20, 120], [18.24, 109.51]], color: '#94a3b8', name: 'Chinese SSBN First Island Chain Patrol' }
        );
        // Ensure chinese_ssn exists (in case it was never created)
        if (!pc.chinese_ssn) pc.chinese_ssn = [];
        pc.chinese_ssn.push(
            { coords: [[18.24, 109.51], [5, 115], [-5, 125], [-15, 130], [-25, 120], [-35, 115], [-40, 125], [-40, 140], [-35, 150], [-25, 155], [-15, 160], [-5, 155], [5, 150], [18.24, 109.51]], color: '#22c55e', name: 'Chinese SSN Circum-Australia Patrol' }
        );

        // Russian Atlantic dominance
        pc.russian_atlantic.push(
            { coords: [[69.26, 33.33], [65, 0], [60, -15], [55, -30], [50, -40], [55, -25], [60, -10], [69.26, 33.33]], color: '#94a3b8', name: 'Russian Mid-Atlantic Control' },
            { coords: [[69.26, 33.33], [60, -10], [50, -25], [40, -40], [35, -50], [40, -45], [55, -20], [69.26, 33.33]], color: '#94a3b8', name: 'Russian US East Coast Approaches' },
            { coords: [[69.26, 33.33], [75, 40], [80, 50], [82, 70], [80, 90], [75, 80], [70, 60], [69.26, 33.33]], color: '#94a3b8', name: 'Russian Arctic Dominance' }
        );
    }
    return pc;
}

// ==================== BASE MARKERS ====================
const baseLocations = {
    'Bangor, WA': {lat:47.73,lng:-122.71,ally:true},
    'Pearl Harbor': {lat:21.34,lng:-157.98,ally:true},
    'Diego Garcia': {lat:-7.32,lng:72.42,ally:true},
    'Kings Bay, GA': {lat:30.80,lng:-81.55,ally:true},
    'Yokosuka': {lat:35.28,lng:139.67,ally:true},
    'HMAS Stirling': {lat:-32.20,lng:115.77,ally:true},
    'Faslane': {lat:56.03,lng:-4.92,ally:true},
    'Île Longue': {lat:48.39,lng:-4.49,ally:true},
    'Kamchatka': {lat:53.01,lng:158.65,ally:false},
    'Gadzhiyevo': {lat:69.26,lng:33.33,ally:false},
    'Yalong Bay': {lat:18.24,lng:109.51,ally:false},
    'Visakhapatnam': {lat:17.68,lng:83.22,ally:false}
};

// ==================== GLOBE INITIALIZATION ====================
async function initGlobe() {
    const resp = await fetch('https://unpkg.com/world-atlas/countries-110m.json');
    const topo = await resp.json();
    const countries = topojson.feature(topo, topo.objects.countries).features;

    globe = Globe()(document.getElementById('globeViz'))
        .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
        .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
        .pointOfView({ lat: 15, lng: 100, altitude: 2.8 })
        .polygonsData(countries)
        .polygonCapColor(f => getCountryUmbrella(f.properties.name).col)
        .polygonSideColor(() => 'rgba(0,0,0,0.15)')
        .polygonStrokeColor(() => '#222')
        .polygonLabel(f => `<b>${f.properties.name}</b><br>${getCountryUmbrella(f.properties.name).name}`)
        .pathsData(getVisiblePaths())
        .pathPoints('coords')
        .pathPointLat(p => p[0])
        .pathPointLng(p => p[1])
        .pathColor(d => d.color)
        .pathLabel(d => d.name)
        .pathStroke(3)
        .pathDashLength(0.25)
        .pathDashGap(0.1)
        .pathDashAnimateTime(12000)
        .htmlElementsData(currentView !== 'umbrellas' ? Object.entries(baseLocations).map(([n, l]) => ({...l, name:n})) : [])
        .htmlElement(d => {
            const el = document.createElement('div');
            el.innerHTML = `<div style="width:36px;height:36px;background:${d.ally?'#3b82f6':'#22c55e'};border:4px solid white;border-radius:50%;box-shadow:0 0 30px ${d.ally?'#3b82f6':'#22c55e'};"></div>`;
            return el;
        });
    updateAll();
}

function getVisiblePaths() {
    if (currentView === 'umbrellas') return [];
    const pc = getPatrolCircuits();
    const paths = [];
    const keys = (currentView === 'all' || currentView === 'pacific') ?
        ['pacific','russian_pacific','chinese','indian_ssbn','us_ssn_pacific','us_ssn_indian_ocean','us_ssn_diego_garcia_patrol','us_ssn_malacca_patrol','us_ssn_hormuz_patrol','chinese_ssn','chinese_ssn_miyako','chinese_ssn_luzon','japanese_ssn_first_island','indian_ssn'] :
        [];
    if (currentView === 'all' || currentView === 'atlantic') {
        keys.push(...['atlantic','russian_atlantic','us_ssn_atlantic','russian_ssn_arctic','uk_ssn','uk_ssn_giuk','french_ssn']);
    }
    keys.forEach(k => pc[k]?.forEach(p => paths.push(p)));
    return paths;
}

// ==================== UI UPDATES ====================
function updateAll() {
    const d = forceData[currentYear];
    document.getElementById('us-warheads').textContent = d.us.toLocaleString();
    document.getElementById('rc-warheads').textContent = d.rc.toLocaleString();
    document.getElementById('sp-warheads').textContent = d.sp;
    document.getElementById('il-warheads').textContent = d.il;
    document.getElementById('in-warheads').textContent = d.in;

    globe.pathsData(getVisiblePaths())
         .polygonsData(globe.polygonsData()) // trigger recolor
         .htmlElementsData(currentView !== 'umbrellas' ? Object.entries(baseLocations).map(([n,l])=>({...l,name:n})) : []);

    const impl = {
        current: `<h3 class="text-xl font-bold text-yellow-400">2025: Full U.S. Extended Deterrence</h3><p class="text-gray-300 mt-2">Global SSBN/SSN presence maintains credible second-strike coverage over allies in Europe and Asia.</p>`,
        '2034': `<h3 class="text-xl font-bold text-orange-400">2034: 30% U.S. Cut</h3><p class="text-gray-300 mt-2">Pacific & Atlantic patrols contract. Taiwan & Philippines lose protection. Sino-Russian forces expand dramatically.</p>`,
        '2040': `<h3 class="text-2xl font-bold text-red-500">2040: U.S. UMBRELLA COLLAPSED</h3><p class="text-gray-300 mt-2">• U.S. loses entire Indian Ocean presence<br>• Pacific SSBNs confined east of Hawaii<br>• Australia, NZ, Japan, South Korea, Philippines, Thailand fall under Sino-Russian influence<br>• Chinese SSBNs operate freely near Hawaii and Australia</p>`
    };
    document.getElementById('implications').innerHTML = impl[currentYear];
}

function setYear(y) {
    currentYear = y;
    document.querySelectorAll('.tab').forEach(b => b.classList.toggle('active', b.id === 'tab-'+y));
    updateAll();
}
function setView(v) {
    currentView = v;
    document.querySelectorAll('.view-btn').forEach(b => b.classList.toggle('active', b.id === 'v-'+v));
    updateAll();
}

// Start
initGlobe();
</script>
</body>
</html>
