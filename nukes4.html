<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuclear Umbrella Collapse · 2025–2040</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { margin:0; background:#000; overflow:hidden; }
        .orbitron { font-family: 'Orbitron', sans-serif; }
        .card { background: rgba(30,41,55,0.95); backdrop-filter: blur(12px); border: 1px solid rgba(100,116,139,0.3); }
        @keyframes glow { 0%,100% { text-shadow: 0 0 20px #ff006e; } 50% { text-shadow: 0 0 40px #ff006e, 0 0 60px #ff006e; } }
        h1 { animation: glow 4s infinite; }
        .tab.active { background: linear-gradient(135deg, #dc2626, #f97316); box-shadow: 0 0 30px rgba(239,68,68,0.6); }
        .view-btn.active { background: #1e40af; box-shadow: 0 0 20px rgba(59,130,246,0.7); }
        #globeViz { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; }
    </style>
</head>
<body>

<div id="globeViz"></div>

<!-- Title -->
<div class="fixed top-4 left-1/2 -translate-x-1/2 z-10 text-center">
    <h1 class="text-5xl md:text-7xl font-black orbitron bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 bg-clip-text text-transparent">
        NUCLEAR UMBRELLA COLLAPSE
    </h1>
    <p class="text-xl mt-2 text-gray-300">2025 → 2034 → 2040</p>
    <div class="flex justify-center gap-4 mt-6 flex-wrap">
        <button onclick="setYear('current')" class="tab active px-6 py-3 rounded-lg text-lg font-bold" id="tab-current">2025</button>
        <button onclick="setYear('2034')" class="tab px-6 py-3 rounded-lg text-lg font-bold" id="tab-2034">2034</button>
        <button onclick="setYear('2040')" class="tab px-6 py-3 rounded-lg text-lg font-bold" id="tab-2040">2040</button>
    </div>
</div>

<!-- Warhead Counter -->
<div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-10 card p-6 rounded-2xl shadow-2xl">
    <div class="grid grid-cols-5 gap-6 text-center text-sm">
        <div><div class="text-4xl font-black text-blue-400" id="us-warheads">5,244</div><div class="text-gray-400">US</div></div>
        <div><div class="text-4xl font-black text-green-400" id="rc-warheads">7,420</div><div class="text-gray-400">RU+CN</div></div>
        <div><div class="text-4xl font-black text-gray-500">~520</div><div class="text-gray-400">PK/SA</div></div>
        <div><div class="text-4xl font-black text-white">~90</div><div class="text-gray-400">Israel</div></div>
        <div><div class="text-4xl font-black text-amber-700">~300</div><div class="text-gray-400">India</div></div>
    </div>
</div>

<!-- View Buttons -->
<div class="fixed top-4 right-4 z-10 card p-4 rounded-xl">
    <div class="grid grid-cols-4 gap-3 text-xs">
        <button onclick="setView('all')" class="view-btn active py-2 px-4 rounded font-bold" id="v-all">All</button>
        <button onclick="setView('pacific')" class="view-btn py-2 px-4 rounded font-bold" id="v-pacific">Pacific</button>
        <button onclick="setView('atlantic')" class="view-btn py-2 px-4 rounded font-bold" id="v-atlantic">Atlantic</button>
        <button onclick="setView('umbrellas')" class="view-btn py-2 px-4 rounded font-bold" id="v-umbrellas">Umbrellas</button>
    </div>
</div>

<!-- Implications -->
<div class="fixed bottom-8 right-8 max-w-sm card p-6 rounded-2xl text-sm leading-relaxed" id="implications">
    <h3 class="text-xl font-bold text-yellow-400">2025: Full U.S. Extended Deterrence</h3>
    <p class="text-gray-300 mt-2">Global SSBN/SSN presence maintains credible second-strike coverage over allies in Europe and Asia.</p>
</div>

<script>
let globe, currentYear = 'current';

// ==================== FULL PATROL DATA ====================

// 2025 - Full Global Presence
const currentPatrols = [
    {coords: [[47.73,-122.71],[50,-140],[52,-160],[50,-175],[45,170],[40,160],[35,150],[30,140],[35,130],[40,135],[45,140],[47.73,-122.71]], color:'#3b82f6', name:'U.S. Pacific SSBN'},
    {coords: [[30.80,-81.55],[35,-70],[40,-60],[50,-45],[60,-30],[65,-20],[62,-10],[58,0],[55,10],[50,5],[45,-10],[40,-25],[35,-40],[30.80,-81.55]], color:'#8b5cf6', name:'U.S. Atlantic SSBN'},
    {coords: [[56.03,-4.92],[55,-20],[60,-30],[50,-40],[55,-35],[56.03,-4.92]], color:'#8b5cf6', name:'UK Vanguard'},
    {coords: [[48.39,-4.49],[50,-20],[55,-30],[45,-35],[48.39,-4.49]], color:'#8b5cf6', name:'French Triomphant'},
    {coords: [[53.01,158.65],[55,165],[58,170],[60,175],[58,-175],[55,-170],[52,-165],[50,160],[53.01,158.65]], color:'#94a3b8', name:'Russian Pacific SSBN'},
    {coords: [[69.26,33.33],[72,35],[75,30],[75,20],[73,10],[70,5],[68,15],[69,25],[69.26,33.33]], color:'#94a3b8', name:'Russian Atlantic SSBN'},
    {coords: [[18.24,109.51],[15,115],[12,120],[10,125],[15,130],[20,128],[22,120],[18.24,109.51]], color:'#94a3b8', name:'Chinese SSBN Bastion'},
    {coords: [[-7.32,72.42],[-10,75],[-12,80],[-15,85],[-18,90],[-20,95],[-22,100],[-25,105],[-28,110],[-30,112],[-32,115.77]], color:'#ef4444', name:'US SSN Indian Ocean'},
    {coords: [[21.35,-157.92],[20,-160],[15,-170],[10,160],[15,150],[20,140],[21.35,-157.92]], color:'#ef4444', name:'US SSN Pacific'},
    {coords: [[18.24,109.51],[20,118],[23,123],[25,126],[26,128],[25,127],[23,124],[20,120],[18.24,109.51]], color:'#22c55e', name:'Chinese SSN Miyako'}
];

// 2034 - U.S. Retreat, China/Russia Expand
const patrols2034 = [
    {coords: [[47.7,-122.7],[48,-150],[45,-165],[40,-175],[47.7,-122.7]], color:'#3b82f6', name:'U.S. Pacific SSBN (Reduced – Mid-Pacific only)'},
    {coords: [[30.8,-81.6],[38,-70],[48,-50],[52,-30],[45,-20],[30.8,-81.6]], color:'#8b5cf6', name:'U.S. Atlantic SSBN (Reduced – No GIUK)'},
    {coords: [[21,-158],[15,-170],[10,170],[15,155],[21,-158]], color:'#ef4444', name:'U.S. SSN Hawaii Defense Ring'},
    {coords: [[18.2,109.5],[20,130],[28,145],[25,160],[18.2,109.5]], color:'#22c55e', name:'China SSBN → Second Island Chain'},
    {coords: [[18.2,109.5],[5,110],[-10,105],[-20,115],[-10,130],[5,125],[18.2,109.5]], color:'#22c55e', name:'China SSN → Northern Australia'},
    {coords: [[69,33],[70,10],[68,-10],[65,-25],[69,33]], color:'#94a3b8', name:'Russia SSBN → GIUK Penetration'}
];

// 2040 - U.S. Collapsed Umbrella
const patrols2040 = [
    {coords: [[47.7,-122.7],[35,-140],[25,-150],[21,-158],[30,-165],[47.7,-122.7]], color:'#3b82f6', name:'U.S. Pacific SSBN – Hawaiian Sanctuary'},
    {coords: [[30.8,-81.6],[35,-75],[40,-68],[38,-65],[30.8,-81.6]], color:'#8b5cf6', name:'U.S. Atlantic SSBN – East Coast Bastion'},
    {coords: [[40,-75],[48,-60],[45,-50],[38,-65],[40,-75]], color:'#ef4444', name:'U.S. SSN East Coast Ring'},
    {coords: [[25,-90],[15,-100],[5,-105],[-5,-95],[25,-90]], color:'#ef4444', name:'U.S. SSN Caribbean Ring'},
    {coords: [[18.2,109.5],[22,150],[20,170],[15,175],[18.2,109.5]], color:'#22c55e', name:'China SSBN → Hawaii Approaches'},
    {coords: [[18.2,109.5],[40,165],[50,-170],[45,175],[18.2,109.5]], color:'#22c55e', name:'China SSBN → Alaska Interdiction'},
    {coords: [[18.2,109.5],[0,115],[-25,110],[-40,130],[-35,160],[-10,165],[10,150],[18.2,109.5]], color:'#22c55e', name:'China SSN Encirclement of Australia'},
    {coords: [[56,-5],[68,5],[70,20],[65,30],[56,-5]], color:'#8b5cf6', name:'UK/French GIUK-Norwegian Defense'}
];

const patrols = { current: currentPatrols, '2034': patrols2034, '2040': patrols2040 };

// ==================== UMBRELLA LOGIC ====================
function getUmbrella(country) {
    const usUmbrella = ['United States of America','Canada','Mexico','United Kingdom','France','Germany','Italy','Poland','Japan','South Korea','Australia','New Zealand','Philippines','Taiwan','Thailand','Singapore'];
    const sinoRusCore = ['Russia','China','North Korea','Iran','Venezuela','Cuba','Belarus'];
    const pkSa = ['Pakistan','Saudi Arabia'];
    const israel = ['Israel'];
    const india = ['India','Bhutan'];

    if (currentYear === '2040') {
        const sinoRus2040 = [...sinoRusCore, 'Japan','South Korea','Australia','New Zealand','Philippines','Thailand','Singapore','Taiwan','Indonesia','Malaysia','Vietnam','Cambodia','Laos','Myanmar','Mongolia'];
        if (sinoRus2040.includes(country)) return {col:'rgba(34,197,94,0.95)', name:'Sino-Russian Bloc'};
    }
    if (currentYear === '2034' && ['Taiwan','Philippines'].includes(country))
        return {col:'rgba(34,197,94,0.6)', name:'Sino-Russian Influence'};

    if (usUmbrella.includes(country)) return {col:'rgba(59,130,246,0.75)', name:'U.S. Umbrella'};
    if (sinoRusCore.includes(country)) return {col:'rgba(34,197,94,0.9)', name:'Sino-Russian Core'};
    if (pkSa.includes(country)) return {col:'rgba(150,150,150,0.9)', name:'Pakistan-Saudi Axis'};
    if (israel.includes(country)) return {col:'rgba(255,255,255,0.95)', name:'Israel'};
    if (india.includes(country)) return {col:'rgba(160,82,45,0.9)', name:'India'};
    return {col:'rgba(60,60,80,0.4)', name:'Neutral'};
}

// ==================== GLOBE SETUP ====================
async function initGlobe() {
    const resp = await fetch('https://unpkg.com/world-atlas/countries-110m.json');
    const topo = await resp.json();
    const countries = topojson.feature(topo, topo.objects.countries).features;

    globe = Globe()(document.getElementById('globeViz'))
        .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
        .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
        .pointOfView({ lat: 25, lng: 0, altitude: 2.5 })  // Centered perfectly
        .polygonsData(countries)
        .polygonCapColor(f => getUmbrella(f.properties.name).col)
        .polygonSideColor(() => 'rgba(0,0,0,0.2)')
        .polygonStrokeColor(() => '#111')
        .polygonLabel(f => `<div class="text-xs"><b>${f.properties.name}</b><br>${getUmbrella(f.properties.name).name}</div>`)
        .pathsData(getPatrols())
        .pathPoints('coords')
        .pathPointLat(p => p[0])
        .pathPointLng(p => p[1])
        .pathColor(d => d.color)
        .pathLabel(d => d.name)
        .pathStroke(3.5)
        .pathDashLength(0.25)
        .pathDashGap(0.08)
        .pathDashAnimateTime(14000);

    globe.controls().autoRotate = true;
    globe.controls().autoRotateSpeed = 0.5;
}

function getPatrols() { return patrols[currentYear] || patrols.current; }

function setYear(y) {
    currentYear = y;
    document.querySelectorAll('.tab').forEach(b => b.classList.toggle('active', b.id === 'tab-' + y));
    globe.pathsData(getPatrols()).polygonsData(globe.polygonsData());
    updateNumbers();
    renderImplications();
}

function setView(v) {
    document.querySelectorAll('.view-btn').forEach(b => b.classList.toggle('active', b.id === 'v-' + v));
    globe.pathsData(v === 'umbrellas' ? [] : getPatrols());
}

function updateNumbers() {
    const nums = { current: [5244,7420], '2034': [3660,11130], '2040': [2100,18500] }[currentYear];
    document.getElementById('us-warheads').textContent = nums[0].toLocaleString();
    document.getElementById('rc-warheads').textContent = nums[1].toLocaleString();
}

function renderImplications() {
    const text = {
        current: `<h3 class="text-xl font-bold text-cyan-400">2025: Full U.S. Extended Deterrence</h3><p class="text-gray-300 mt-2">Global SSBN/SSN presence maintains credible second-strike coverage over allies worldwide.</p>`,
        '2034': `<h3 class="text-xl font-bold text-orange-400">2034: Collapse Begins</h3><p class="text-gray-300 mt-2">Taiwan & Philippines lose protection.<br>China pushes to Second Island Chain.<br>Japan & South Korea go nuclear-latent.</p>`,
        '2040': `<h3 class="text-2xl font-bold text-red-500">2040: U.S. UMBRELLA GONE</h3><p class="text-gray-200 mt-2">America retreats to coastal bastions.<br>China now patrols Hawaii & Alaska approaches.<br>Most of Asia-Pacific under <span class="text-green-400 font-bold">Sino-Russian nuclear umbrella</span>.</p>`
    };
    document.getElementById('implications').innerHTML = text[currentYear];
}

initGlobe().then(() => { updateNumbers(); renderImplications(); });
</script>

</body>
</html>
