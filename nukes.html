<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Nuclear Warhead Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        .orbitron { font-family: 'Orbitron', monospace; }
        .speed-card {
            background: linear-gradient(to bottom right, rgba(31, 41, 55, 0.8), rgba(15, 23, 42, 0.8));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .shimmer-text {
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
        }
        .region-btn, .country-btn {
            transition: all 0.2s;
        }
        .region-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        .country-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(234, 179, 8, 0.4);
        }
        .modal-item {
            cursor: pointer;
            transition: all 0.2s;
        }
        .modal-item:hover {
            background: rgba(239, 68, 68, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-red-950 to-slate-900 min-h-screen text-white">
    <div class="container mx-auto p-4">
        <!-- Header -->
        <div class="mb-6 speed-card p-6 rounded-xl">
            <h1 class="text-4xl md:text-6xl font-black mb-4 text-center orbitron bg-gradient-to-r from-red-400 via-orange-400 to-yellow-400 bg-clip-text text-transparent shimmer-text">
                Global Nuclear Arsenal
            </h1>
            <p class="text-center text-gray-300 text-sm">
                Tracking <span id="totalWarheads" class="font-bold text-red-400">0</span> warheads across
                <span id="totalCountries" class="font-bold text-orange-400">0</span> nuclear powers in
                <span id="totalRegions" class="font-bold text-yellow-400">0</span> regions
            </p>
        </div>

        <!-- Loading State -->
        <div id="loading" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"></div>
            <p class="mt-4 text-gray-400">Loading nuclear arsenal data...</p>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="hidden">
            <!-- Global Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="speed-card p-6 rounded-xl">
                    <div class="text-gray-400 text-sm mb-2">Total Stockpile</div>
                    <div class="text-4xl font-black orbitron text-red-400" id="statTotal">0</div>
                </div>
                <div class="speed-card p-6 rounded-xl">
                    <div class="text-gray-400 text-sm mb-2">Deployed Warheads</div>
                    <div class="text-4xl font-black orbitron text-orange-400" id="statDeployed">0</div>
                </div>
                <div class="speed-card p-6 rounded-xl">
                    <div class="text-gray-400 text-sm mb-2">Strategic Nukes</div>
                    <div class="text-4xl font-black orbitron text-yellow-400" id="statStrategic">0</div>
                </div>
            </div>

            <!-- Map -->
            <div class="mb-6 speed-card p-6 rounded-xl">
                <h2 class="text-2xl font-bold orbitron mb-4 text-red-400">Global Nuclear Distribution</h2>
                <div id="worldMap" class="w-full" style="height: 500px;"></div>
            </div>

            <!-- Regional Breakdown -->
            <div class="mb-6 speed-card p-6 rounded-xl">
                <h2 class="text-2xl font-bold orbitron mb-4 text-orange-400">Browse by Region</h2>
                <div id="regionsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>

            <!-- Countries Grid -->
            <div class="mb-6 speed-card p-6 rounded-xl">
                <h2 class="text-2xl font-bold orbitron mb-4 text-yellow-400">Browse by Country</h2>
                <div class="mb-4">
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="Search countries..."
                        class="w-full px-4 py-2 bg-slate-800/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500"
                    >
                </div>
                <div id="countriesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 max-h-96 overflow-y-auto"></div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="speed-card p-6 rounded-xl">
                    <h2 class="text-xl font-bold orbitron mb-4 text-red-400">Warheads by Type</h2>
                    <div id="typeChart" style="height: 400px;"></div>
                </div>
                <div class="speed-card p-6 rounded-xl">
                    <h2 class="text-xl font-bold orbitron mb-4 text-orange-400">Regional Distribution</h2>
                    <div id="regionChart" style="height: 400px;"></div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="infoModal" class="fixed inset-0 bg-black/70 hidden flex items-center justify-center z-50 p-4" onclick="closeModal()">
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto border border-slate-600/50" onclick="event.stopPropagation()">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 id="modalTitle" class="text-3xl font-black orbitron text-white mb-2"></h3>
                        <p id="modalSubtitle" class="text-sm text-gray-400"></p>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script>
        let nuclearData = [];
        let regionData = {};
        let countryData = {};

        async function loadData() {
            try {
                const response = await fetch('https://cdn.jsdelivr.net/gh/ayeeff/fiefdom@latest/data/nukes.csv');
                const csvText = await response.text();
               
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true,
                    complete: function(results) {
                        nuclearData = results.data;
                        processData();
                        renderDashboard();
                    }
                });
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = '<p class="text-red-400">Error loading data. Please try again.</p>';
            }
        }

        function parseNumber(val) {
            if (val === null || val === undefined || val === '‚Äî' || val === '') return 0;
            if (typeof val === 'number') return val;
            const str = String(val).replace(/[~,]/g, '').trim();
            const num = parseFloat(str);
            return isNaN(num) ? 0 : num;
        }

        function processData() {
            regionData = {};
            countryData = {};
           
            nuclearData.forEach(row => {
                const region = row.Region || 'Unknown';
                const countryLeg = row['Country / leg'] || 'Unknown';
                const country = countryLeg.split('‚Äì')[0].trim();
               
                if (!regionData[region]) {
                    regionData[region] = {
                        entries: [],
                        totalStockpile: 0,
                        totalDeployed: 0,
                        totalStrategic: 0,
                        totalTactical: 0
                    };
                }
               
                const entry = {
                    countryLeg: countryLeg,
                    country: country,
                    totalStockpile: parseNumber(row['Total Stockpile']),
                    deployed: parseNumber(row['Deployed Warheads']),
                    strategic: parseNumber(row['Strategic Nukes']),
                    tactical: parseNumber(row['Tactical Nukes']),
                    slbm: parseNumber(row['SLBM Warheads']),
                    homeBase: row['Home Base'] || 'Unknown',
                    notes: row['Notes'] || ''
                };
               
                regionData[region].entries.push(entry);
                regionData[region].totalStockpile += entry.totalStockpile;
                regionData[region].totalDeployed += entry.deployed;
                regionData[region].totalStrategic += entry.strategic;
                regionData[region].totalTactical += entry.tactical;
               
                if (!countryData[country]) {
                    countryData[country] = {
                        entries: [],
                        totalStockpile: 0,
                        regions: new Set()
                    };
                }
                countryData[country].entries.push({...entry, region: region});
                countryData[country].totalStockpile += entry.totalStockpile;
                countryData[country].regions.add(region);
            });
        }

        function renderDashboard() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
           
            const totalStockpile = Object.values(regionData).reduce((sum, r) => sum + r.totalStockpile, 0);
            const totalDeployed = Object.values(regionData).reduce((sum, r) => sum + r.totalDeployed, 0);
            const totalStrategic = Object.values(regionData).reduce((sum, r) => sum + r.totalStrategic, 0);
           
            document.getElementById('totalWarheads').textContent = totalStockpile.toLocaleString();
            document.getElementById('totalCountries').textContent = Object.keys(countryData).length;
            document.getElementById('totalRegions').textContent = Object.keys(regionData).length;
           
            document.getElementById('statTotal').textContent = totalStockpile.toLocaleString();
            document.getElementById('statDeployed').textContent = totalDeployed.toLocaleString();
            document.getElementById('statStrategic').textContent = totalStrategic.toLocaleString();
           
            renderMap();
            renderRegionsGrid();
            renderCountriesGrid();
            renderCharts();
            setupSearch();
        }

        function renderMap() {
            const countryTotals = {};
            Object.entries(countryData).forEach(([country, data]) => {
                countryTotals[country] = data.totalStockpile;
            });
           
            const countries = Object.keys(countryTotals);
            const values = Object.values(countryTotals);
           
            const data = [{
                type: 'choropleth',
                locationmode: 'country names',
                locations: countries,
                z: values,
                text: countries.map(c => `${c}: ${countryTotals[c].toLocaleString()} warheads`),
                colorscale: [
                    [0, '#1e293b'],
                    [0.2, '#7f1d1d'],
                    [0.4, '#991b1b'],
                    [0.6, '#dc2626'],
                    [0.8, '#f97316'],
                    [1, '#facc15']
                ],
                colorbar: {
                    title: 'Total<br>Warheads',
                    thickness: 15,
                    len: 0.7,
                    bgcolor: 'rgba(15, 23, 42, 0.8)',
                    tickfont: { color: '#e2e8f0' },
                    titlefont: { color: '#e2e8f0' }
                },
                hovertemplate: '<b>%{text}</b><extra></extra>'
            }];

            const layout = {
                geo: {
                    projection: { type: 'natural earth' },
                    bgcolor: 'rgba(15, 23, 42, 0.5)',
                    showland: true,
                    landcolor: '#1e293b',
                    showocean: true,
                    oceancolor: '#0f172a',
                    showcountries: true,
                    countrycolor: '#334155',
                    coastlinecolor: '#475569'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e2e8f0' },
                margin: { t: 0, b: 0, l: 0, r: 0 }
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            Plotly.newPlot('worldMap', data, layout, config);
           
            document.getElementById('worldMap').on('plotly_click', function(data) {
                const country = data.points[0].location;
                showCountryModal(country);
            });
        }

        function renderRegionsGrid() {
            const grid = document.getElementById('regionsGrid');
            const regions = Object.keys(regionData).sort();
           
            grid.innerHTML = regions.map(region => {
                const data = regionData[region];
                return `
                    <button
                        onclick="showRegionModal('${region.replace(/'/g, "\\'")}')"
                        class="region-btn p-4 bg-gradient-to-br from-red-600/20 to-orange-600/20 hover:from-red-600/40 hover:to-orange-600/40 border border-red-500/30 rounded-lg text-left"
                    >
                        <div class="font-bold text-xl text-white mb-2">${region}</div>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div>
                                <div class="text-gray-400">Total Stockpile</div>
                                <div class="text-red-400 font-bold">${data.totalStockpile.toLocaleString()}</div>
                            </div>
                            <div>
                                <div class="text-gray-400">Deployed</div>
                                <div class="text-orange-400 font-bold">${data.totalDeployed.toLocaleString()}</div>
                            </div>
                            <div>
                                <div class="text-gray-400">Strategic</div>
                                <div class="text-yellow-400 font-bold">${data.totalStrategic.toLocaleString()}</div>
                            </div>
                            <div>
                                <div class="text-gray-400">Tactical</div>
                                <div class="text-amber-400 font-bold">${data.totalTactical.toLocaleString()}</div>
                            </div>
                        </div>
                    </button>
                `;
            }).join('');
        }

        function renderCountriesGrid(filter = '') {
            const grid = document.getElementById('countriesGrid');
            const countries = Object.keys(countryData).sort();
           
            const filtered = filter
                ? countries.filter(c => c.toLowerCase().includes(filter.toLowerCase()))
                : countries;
           
            grid.innerHTML = filtered.map(country => {
                const data = countryData[country];
                return `
                    <button
                        onclick="showCountryModal('${country.replace(/'/g, "\\'")}')"
                        class="country-btn px-3 py-2 bg-gradient-to-br from-yellow-600/20 to-red-600/20 hover:from-yellow-600/40 hover:to-red-600/40 border border-yellow-500/30 rounded-lg text-left"
                    >
                        <div class="font-semibold text-white text-sm">${country}</div>
                        <div class="text-xs text-gray-400">${data.totalStockpile.toLocaleString()} warheads</div>
                        <div class="text-xs text-yellow-400">${data.regions.size} region${data.regions.size !== 1 ? 's' : ''}</div>
                    </button>
                `;
            }).join('');
        }

        function renderCharts() {
            // Type breakdown
            const totalStrategic = Object.values(regionData).reduce((sum, r) => sum + r.totalStrategic, 0);
            const totalTactical = Object.values(regionData).reduce((sum, r) => sum + r.totalTactical, 0);
           
            const typeData = [{
                values: [totalStrategic, totalTactical],
                labels: ['Strategic', 'Tactical'],
                type: 'pie',
                marker: {
                    colors: ['#facc15', '#f97316']
                },
                textfont: { color: '#ffffff', size: 14 },
                hovertemplate: '<b>%{label}</b><br>%{value:,} warheads<br>%{percent}<extra></extra>'
            }];

            const typeLayout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e2e8f0' },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.1
                },
                margin: { t: 20, b: 40, l: 20, r: 20 }
            };

            Plotly.newPlot('typeChart', typeData, typeLayout, {responsive: true, displayModeBar: false});

            // Regional distribution
            const regions = Object.keys(regionData).sort();
            const regionalData = [{
                x: regions,
                y: regions.map(r => regionData[r].totalStockpile),
                type: 'bar',
                marker: {
                    color: regions.map((r, i) => ['#dc2626', '#f97316', '#facc15'][i % 3])
                },
                hovertemplate: '<b>%{x}</b><br>%{y:,} warheads<extra></extra>'
            }];

            const regionalLayout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e2e8f0' },
                xaxis: {
                    gridcolor: 'rgba(148, 163, 184, 0.1)',
                    tickfont: { size: 11 }
                },
                yaxis: {
                    gridcolor: 'rgba(148, 163, 184, 0.1)',
                    title: 'Total Warheads'
                },
                margin: { t: 20, b: 60, l: 60, r: 20 }
            };

            Plotly.newPlot('regionChart', regionalData, regionalLayout, {responsive: true, displayModeBar: false});
        }

        function setupSearch() {
            document.getElementById('searchInput').addEventListener('input', (e) => {
                renderCountriesGrid(e.target.value);
            });
        }

        function showRegionModal(region) {
            const data = regionData[region];
           
            document.getElementById('modalTitle').textContent = region;
            document.getElementById('modalSubtitle').textContent = `${data.totalStockpile.toLocaleString()} total warheads across ${data.entries.length} deployment${data.entries.length !== 1 ? 's' : ''}`;
           
            const content = `
                <div class="grid gap-3">
                    ${data.entries.map(entry => `
                        <div class="p-4 bg-gradient-to-br from-slate-700/40 to-slate-800/40 border border-slate-600/30 rounded-xl">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg text-white">${entry.countryLeg}</h4>
                                    <p class="text-sm text-gray-400 mt-1">üìç ${entry.homeBase}</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-black orbitron text-red-400">${entry.totalStockpile.toLocaleString()}</div>
                                    <div class="text-xs text-gray-400">total</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-3">
                                <div class="bg-slate-800/50 p-2 rounded">
                                    <div class="text-xs text-gray-400">Deployed</div>
                                    <div class="text-orange-400 font-bold">${entry.deployed.toLocaleString()}</div>
                                </div>
                                <div class="bg-slate-800/50 p-2 rounded">
                                    <div class="text-xs text-gray-400">Strategic</div>
                                    <div class="text-yellow-400 font-bold">${entry.strategic.toLocaleString()}</div>
                                </div>
                                <div class="bg-slate-800/50 p-2 rounded">
                                    <div class="text-xs text-gray-400">Tactical</div>
                                    <div class="text-amber-400 font-bold">${entry.tactical.toLocaleString()}</div>
                                </div>
                                <div class="bg-slate-800/50 p-2 rounded">
                                    <div class="text-xs text-gray-400">SLBM</div>
                                    <div class="text-blue-400 font-bold">${entry.slbm.toLocaleString()}</div>
                                </div>
                            </div>
                            ${entry.notes ? `<div class="text-xs text-gray-400 italic border-l-2 border-slate-600 pl-3">${entry.notes}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
           
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('infoModal').classList.remove('hidden');
        }

        function showCountryModal(country) {
            const data = countryData[country];
            if (!data) return;
           
            document.getElementById('modalTitle').textContent = country;
            document.getElementById('modalSubtitle').textContent = `${data.totalStockpile.toLocaleString()} total warheads across ${data.entries.length} deployment${data.entries.length !== 1 ? 's' : ''}`;
           
            const content = `
                <div class="grid gap-3">
                    ${data.entries.map(entry => `
                        <div class="p-4 bg-gradient-to-br from-slate-700/40 to-slate-800/40 border border-slate-600/30 rounded-xl">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg text-white">${entry.countryLeg}</h4>
                                    <p class="text-sm text-purple-400 mt-1">Region: ${entry.region}</p>
                                    <p class="text-sm text-gray-400">üìç ${entry.homeBase}</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-black orbitron text-red-400">${entry.totalStockpile.toLocaleString()}</div>
                                    <div class="text-xs text-gray-400">total</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-3">
                                <div class="bg-slate-800/50 p-2 rounded">
                                    <div class="text-xs text-gray-400">Deployed</div>
                                    <div class="text-orange-400 font-bold">${entry.deployed.toLocaleString()}</div>
                                </div>
                                <div class="bg-slate-800/50 p-2 rounded">
                                    <div class="text-xs text-gray-400">Strategic</div>
                                    <div class="text-yellow-400 font-bold">${entry.strategic.toLocaleString()}</div>
                                </div>
                                <div class="bg-slate-800/50 p-2 rounded">
                                    <div class="text-xs text-gray-400">Tactical</div>
                                    <div class="text-amber-400 font-bold">${entry.tactical.toLocaleString()}</div>
                                </div>
                                <div class="bg-slate-800/50 p-2 rounded">
                                    <div class="text-xs text-gray-400">SLBM</div>
                                    <div class="text-blue-400 font-bold">${entry.slbm.toLocaleString()}</div>
                                </div>
                            </div>
                            ${entry.notes ? `<div class="text-xs text-gray-400 italic border-l-2 border-slate-600 pl-3">${entry.notes}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
           
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('infoModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('infoModal').classList.add('hidden');
        }

        loadData();
    </script>
</body>
</html>
