<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Historical Migration Routes to Australia</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />

  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, sans-serif;
    }
    #map { height: calc(100vh - 200px); width: 100%; }
    .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .legend-color { width: 24px; height: 4px; border-radius: 2px; }
    .route-checkbox { margin-right: 8px; cursor: pointer; }
    .custom-marker, .ship-marker { background: transparent; border: none; }
    #stop-info { max-width: 320px; transition: opacity 0.3s ease; }
    #stop-info.hidden { display: none; }
    #stop-route-color { height: 4px; border-radius: 2px; }
    #route-summary { backdrop-filter: blur(10px); }

    @media (max-width: 768px) {
      #map { height: calc(100vh - 250px); }
      #stop-info { max-width: 280px; left: 1rem; right: 1rem; }
      .legend-item { font-size: 0.875rem; }
    }
    @media print {
      header, footer { display: none; }
      #map { height: 100vh; page-break-after: always; }
      #stop-info, #route-summary { display: none; }
    }
    .route-checkbox:focus, button:focus { outline: 2px solid #2563eb; outline-offset: 2px; }
    .custom-marker:hover { transform: scale(1.1); transition: transform 0.2s ease; }
    .leaflet-popup-content-wrapper { border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .leaflet-popup-content { margin: 12px; }
    .leaflet-interactive:hover { stroke-width: 5; transition: stroke-width 0.2s ease; }
  </style>
</head>

<body class="bg-gray-50">
  <header class="bg-white shadow-md p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-4">Historical Migration Routes to Australia</h1>
    <div class="flex gap-6 flex-wrap items-start">
      <div class="flex items-center">
        <input type="checkbox" id="check-first-fleet" class="route-checkbox w-5 h-5" checked>
        <label for="check-first-fleet" class="flex items-center gap-2 cursor-pointer">
          <div class="legend-color" style="background-color: #16a34a; width: 30px;"></div>
          <span class="font-medium text-gray-700">First Fleet (1787-1788)</span>
        </label>
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="check-second-fleet" class="route-checkbox w-5 h-5" checked>
        <label for="check-second-fleet" class="flex items-center gap-2 cursor-pointer">
          <div class="legend-color" style="background-color: #dc2626; width: 30px;"></div>
          <span class="font-medium text-gray-700">Second Fleet (1790)</span>
        </label>
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="check-guangzhou" class="route-checkbox w-5 h-5" checked>
        <label for="check-guangzhou" class="flex items-center gap-2 cursor-pointer">
          <div class="legend-color" style="background-color: #2563eb; width: 30px;"></div>
          <span class="font-medium text-gray-700">Chinese Miners (1850s-60s)</span>
        </label>
      </div>
    </div>
  </header>

  <main class="relative">
    <div id="map"></div>

    <div id="stop-info" class="hidden absolute top-4 right-4 bg-white rounded-lg shadow-xl p-4 max-w-sm" style="z-index: 1000;">
      <button id="close-info" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-xl font-bold">√ó</button>
      <div id="stop-route-color" class="w-full h-1 rounded-full mb-3"></div>
      <h3 id="stop-name" class="font-bold text-lg text-gray-800 mb-2 pr-6"></h3>
      <p id="stop-description" class="text-sm text-gray-600 mb-2"></p>
      <p id="stop-distance" class="text-xs text-gray-500 font-medium"></p>
    </div>

    <div class="absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 max-w-2xl" style="z-index: 1000;">
      <h3 class="font-bold text-gray-800 mb-3">Route Information</h3>
      <div class="grid md:grid-cols-3 gap-4 text-sm">
        <div id="info-first-fleet">
          <h4 class="font-semibold text-green-700 mb-1">First Fleet (1787-88)</h4>
          <p class="text-xs text-gray-600">252 days, ~15,000‚Äì16,000 nm</p>
          <p class="text-xs text-gray-600">3% mortality, 11 ships</p>
        </div>
        <div id="info-second-fleet">
          <h4 class="font-semibold text-red-700 mb-1">Second Fleet (1790)</h4>
          <p class="text-xs text-gray-600">158‚Äì160 days, ~18,000‚Äì20,000 nm</p>
          <p class="text-xs text-gray-600">26% mortality (~160 deaths)</p>
        </div>
        <div id="info-guangzhou">
          <h4 class="font-semibold text-blue-700 mb-1">Chinese Miners (1850s‚Äì60s)</h4>
          <p class="text-xs text-gray-600">3‚Äì5 months, ~10,500 km total</p>
          <p class="text-xs text-gray-600">~17,000 via Robe, 5‚Äì10% mortality</p>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-gray-800 text-white p-6">
    <div class="max-w-6xl mx-auto grid md:grid-cols-3 gap-6">
      <div>
        <h3 class="font-bold text-lg mb-2">First Fleet (1787‚Äì1788)</h3>
        <p class="text-sm text-gray-300">11 ships with careful planning and resupply stops at Tenerife, Rio de Janeiro, and Cape Town. Low mortality (3%) due to better provisions and Captain Phillip‚Äôs humane approach.</p>
      </div>
      <div>
        <h3 class="font-bold text-lg mb-2">Second Fleet (1790)</h3>
        <p class="text-sm text-gray-300">Brutal voyage with 26% mortality due to starvation and abuse by contractors. Known as the ‚ÄúDeath Fleet.‚Äù</p>
      </div>
      <div>
        <h3 class="font-bold text-lg mb-2">Chinese Gold Miners (1850s‚Äì60s)</h3>
        <p class="text-sm text-gray-300">Voyage from Guangzhou via the Roaring Forties, landing at Robe to avoid Victorian taxes, then walking 500 km to Ballarat under harsh conditions.</p>
      </div>
    </div>
  </footer>

  <!-- Leaflet JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

  <script>
    var speedMultiplier = 2.5; // ‚úÖ Increase to speed up the ships (e.g. 5 = twice as fast)

    var map, routeLayers = {}, shipMarkers = {}, animationIntervals = {};
    var visibleRoutes = { 'first-fleet': true, 'second-fleet': true, 'guangzhou-ballarat': true };

    // (routes object stays the same)
    // ... your routes data here (unchanged for brevity)

    function initMap() {
      map = L.map('map', { center: [-10, 100], zoom: 3, minZoom: 2, maxZoom: 10 });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);
      drawAllRoutes();
    }

    function drawAllRoutes() {
      for (var animId in animationIntervals) clearInterval(animationIntervals[animId]);
      for (var shipId in shipMarkers) if (shipMarkers[shipId]) map.removeLayer(shipMarkers[shipId]);
      shipMarkers = {}; animationIntervals = {};

      var allBounds = [];
      for (var routeId in routes) {
        if (!visibleRoutes[routeId]) continue;

        var route = routes[routeId];
        var coords = route.stops.map(s => [s.lat, s.lng]);
        var polyline = L.polyline(coords, { color: route.color, weight: 3, opacity: 0.7 }).addTo(map);
        (routeLayers[routeId] = [polyline]);
        allBounds.push(polyline.getBounds());

        route.stops.forEach((stop, i) => {
          var markerHtml = `<div style="background-color:${route.color};width:20px;height:20px;border-radius:50%;border:2px solid white;box-shadow:0 2px 4px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;font-weight:bold;color:white;font-size:10px;">${i+1}</div>`;
          var marker = L.marker([stop.lat, stop.lng], { icon: L.divIcon({ className:'custom-marker', html:markerHtml, iconSize:[20,20], iconAnchor:[10,10] }) }).addTo(map);
          marker.stopData = stop; marker.routeColor = route.color;
          marker.on('click', e => showStopInfo(e.target.stopData, e.target.routeColor));
          routeLayers[routeId].push(marker);
        });

        animateShip(routeId, coords, route.color);
      }

      if (allBounds.length > 0) {
        var bounds = allBounds[0];
        for (var i=1; i<allBounds.length; i++) bounds.extend(allBounds[i]);
        map.fitBounds(bounds, { padding:[50,50] });
      }
    }

    function showStopInfo(stop, color) {
      document.getElementById('stop-name').textContent = stop.name;
      document.getElementById('stop-description').textContent = stop.info;
      document.getElementById('stop-distance').textContent = 'Distance: ' + stop.distance;
      document.getElementById('stop-route-color').style.backgroundColor = color;
      document.getElementById('stop-info').classList.remove('hidden');
    }

    function animateShip(routeId, coords, color) {
      if (coords.length < 2) return;

      var shipMarker = L.marker(coords[0], { icon: L.divIcon({ className: 'ship-marker', html: 'üö¢', iconSize: [24,24], iconAnchor:[12,12] }) }).addTo(map);
      shipMarkers[routeId] = shipMarker;

      var currentSegment = 0, progress = 0;
      var baseSpeed = 0.002 * speedMultiplier; // ‚úÖ speed controlled here

      function bearing(start, end) {
        var [lat1, lon1, lat2, lon2] = [start[0], start[1], end[0], end[1]].map(d => d*Math.PI/180);
        var y = Math.sin(lon2-lon1) * Math.cos(lat2);
        var x = Math.cos(lat1)*Math.sin(lat2) - Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);
        return (Math.atan2(y,x)*180/Math.PI + 360) % 360;
      }

      animationIntervals[routeId] = setInterval(() => {
        var start = coords[currentSegment], end = coords[currentSegment+1];
        progress += baseSpeed;
        if (progress >= 1) { progress = 0; currentSegment = (currentSegment+1) % (coords.length-1); start = coords[currentSegment]; end = coords[currentSegment+1]; }
        var lat = start[0] + (end[0]-start[0])*progress;
        var lng = start[1] + (end[1]-start[1])*progress;
        var rot = bearing(start,end)-90;
        var html = `<div style="font-size:20px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));transform:rotate(${rot}deg);transition:transform 0.3s ease;">üö¢</div>`;
        shipMarker.setLatLng([lat,lng]).setIcon(L.divIcon({ className:'ship-marker', html, iconSize:[24,24], iconAnchor:[12,12] }));
      }, 50);
    }

    document.getElementById('check-first-fleet').onchange = e => { visibleRoutes['first-fleet'] = e.target.checked; drawAllRoutes(); };
    document.getElementById('check-second-fleet').onchange = e => { visibleRoutes['second-fleet'] = e.target.checked; drawAllRoutes(); };
    document.getElementById('check-guangzhou').onchange = e => { visibleRoutes['guangzhou-ballarat'] = e.target.checked; drawAllRoutes(); };
    document.getElementById('close-info').onclick = () => document.getElementById('stop-info').classList.add('hidden');

    window.addEventListener('load', initMap);
  </script>
</body>
</html>
